!function(t,e){"undefined"==typeof onTileMapLoaded?("undefined"==typeof TileMaps&&(TileMaps={}),TileMaps.dev_room=e):onTileMapLoaded("dev_room",e),"object"==typeof module&&module&&module.exports&&(module.exports=e)}(0,{compressionlevel:-1,height:39,infinite:!1,layers:[{data:[1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,1048,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,1048,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,1048,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,1048,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,1048,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,1048,1048,1048,1048,1048,1048,1048,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048],height:39,id:1,name:"Tile Layer 1",opacity:1,type:"tilelayer",visible:!0,width:70,x:0,y:0},{draworder:"topdown",id:2,name:"Object Layer 1",objects:[{height:0,id:1,name:"Player",point:!0,properties:[{name:"id",type:"string",value:"player"}],rotation:0,type:"",visible:!0,width:0,x:880.250035462825,y:754.192197850584},{height:0,id:2,name:"Door",point:!0,properties:[{name:"id",type:"string",value:"door"}],rotation:0,type:"",visible:!0,width:0,x:1297.45889387145,y:627.80269058296},{height:0,id:3,name:"Goblin",point:!0,properties:[{name:"id",type:"string",value:"goblin"}],rotation:0,type:"",visible:!0,width:0,x:1297.45889387145,y:488.789237668161},{height:0,id:4,name:"Chest",point:!0,properties:[{name:"id",type:"string",value:"chest"},{name:"inventory",type:"string",value:"health_potion_weak,lightning_scroll_weak"}],rotation:0,type:"",visible:!0,width:0,x:1201.79372197309,y:887.892376681614},{height:0,id:5,name:"Lantern",point:!0,properties:[{name:"id",type:"string",value:"lantern"}],rotation:0,type:"",visible:!0,width:0,x:1139.76083707025,y:757.847533632287},{height:0,id:6,name:"Chest",point:!0,properties:[{name:"id",type:"string",value:"chest"},{name:"inventory",type:"string",value:"health_potion_weak,health_potion_weak"}],rotation:0,type:"",visible:!0,width:0,x:1038.86397608371,y:887.144992526158},{height:0,id:7,name:"Magika Shrine",point:!0,properties:[{name:"id",type:"string",value:"magic_shrine"},{name:"spellId",type:"string",value:"lightning_bolt"}],rotation:0,type:"",visible:!0,width:0,x:1425.26158445441,y:760.837070254111},{height:0,id:8,name:"Crate",point:!0,properties:[{name:"id",type:"string",value:"crate"},{name:"inventory",type:"string",value:"health_potion_weak"}],rotation:0,type:"",visible:!0,width:0,x:1135.27653213752,y:887.144992526158},{height:0,id:9,name:"Door",point:!0,properties:[{name:"id",type:"string",value:"door"}],rotation:0,type:"",visible:!0,width:0,x:1039.61136023916,y:630.792227204783},{height:0,id:10,name:"Goblin Brute",point:!0,properties:[{name:"id",type:"string",value:"goblin_brute"}],rotation:0,type:"",visible:!0,width:0,x:1043.34828101644,y:507.473841554559}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:3,nextobjectid:11,orientation:"orthogonal",renderorder:"right-down",tiledversion:"1.3.4",tileheight:32,tilesets:[{firstgid:1,source:"../DungeonCrawl_ProjectUtumnoTileset.tsx"}],tilewidth:32,type:"map",version:1.2,width:70}),function(t,e){"undefined"==typeof onTileMapLoaded?("undefined"==typeof TileMaps&&(TileMaps={}),TileMaps.level_1=e):onTileMapLoaded("level_1",e),"object"==typeof module&&module&&module.exports&&(module.exports=e)}(0,{compressionlevel:-1,editorsettings:{export:{target:"."}},height:39,infinite:!1,layers:[{data:[1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,1165,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,1165,1165,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,1165,1165,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,1165,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1165,1165,1165,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1165,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048],height:39,id:1,name:"World",opacity:1,type:"tilelayer",visible:!0,width:70,x:0,y:0},{draworder:"topdown",id:4,name:"Object Layer 1",objects:[{height:0,id:4,name:"Player",point:!0,properties:[{name:"id",type:"string",value:"player"}],rotation:0,type:"",visible:!0,width:0,x:434.407214885732,y:597.42625896958},{height:0,id:5,name:"Rat",point:!0,properties:[{name:"id",type:"string",value:"rat"}],rotation:0,type:"",visible:!0,width:0,x:1034.21306581315,y:637.979450172237},{height:0,id:10,name:"Rat",point:!0,properties:[{name:"id",type:"string",value:"rat"}],rotation:0,type:"",visible:!0,width:0,x:946.647780925402,y:1192.16241737488},{height:0,id:11,name:"Door",point:!0,properties:[{name:"id",type:"string",value:"load_door"},{name:"levelName",type:"string",value:"level_2"}],rotation:0,type:"",visible:!0,width:0,x:1553.3522190746,y:567.853960595562},{height:0,id:12,name:"Lantern",point:!0,properties:[{name:"id",type:"string",value:"lantern"}],rotation:0,type:"",visible:!0,width:0,x:1492.09884474265,y:443.42795991692},{height:0,id:17,name:"Crate",point:!0,properties:[{name:"id",type:"string",value:"crate"},{name:"inventory",type:"string",value:"health_potion_weak"}],rotation:0,type:"",visible:!0,width:0,x:528.565696038229,y:52.1822201259912},{height:0,id:18,name:"Lantern",point:!0,properties:[{name:"id",type:"string",value:"lantern"}],rotation:0,type:"",visible:!0,width:0,x:1488.32909637162,y:695.632077651953},{height:0,id:19,name:"Rat",point:!0,properties:[{name:"id",type:"string",value:"rat"}],rotation:0,type:"",visible:!0,width:0,x:681.765657499422,y:97.0649410677145}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:5,nextobjectid:20,orientation:"orthogonal",renderorder:"right-down",tiledversion:"1.3.4",tileheight:32,tilesets:[{firstgid:1,source:"../DungeonCrawl_ProjectUtumnoTileset.tsx"}],tilewidth:32,type:"map",version:1.2,width:70}),function(t,e){"undefined"==typeof onTileMapLoaded?("undefined"==typeof TileMaps&&(TileMaps={}),TileMaps.level_2=e):onTileMapLoaded("level_2",e),"object"==typeof module&&module&&module.exports&&(module.exports=e)}(0,{compressionlevel:-1,editorsettings:{export:{target:"."}},height:39,infinite:!1,layers:[{data:[1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,2936,2936,2936,900,1048,1048,1048,900,900,900,900,900,900,900,2869,900,900,900,2869,900,900,900,2869,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,1048,1048,1048,900,900,900,900,900,2710,2710,2710,2710,2710,2710,2710,2710,2710,2710,2710,2710,2710,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,1048,1048,1048,900,900,900,900,900,2710,2710,2710,2710,2710,2710,2710,2710,2710,2710,2710,2710,2710,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,2869,900,900,900,2869,900,900,900,2869,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,1048,1048,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,1048,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,1048,1048,1048,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,900,900,900,900,900,1048,1048,1048,900,900,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,900,900,900,900,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048,1048],height:39,id:1,name:"World",opacity:1,type:"tilelayer",visible:!0,width:70,x:0,y:0},{draworder:"topdown",id:4,name:"Object Layer 1",objects:[{height:0,id:4,name:"Player",point:!0,properties:[{name:"id",type:"string",value:"player"}],rotation:0,type:"",visible:!0,width:0,x:48.9730893444762,y:727.91157376972},{height:0,id:5,name:"Golbin",point:!0,properties:[{name:"id",type:"string",value:"goblin"}],rotation:0,type:"",visible:!0,width:0,x:644.193719444052,y:712.330540708638},{height:0,id:6,name:"Chest",point:!0,properties:[{name:"id",type:"string",value:"chest"},{name:"inventory",type:"string",value:"health_potion_weak,lightning_scroll_weak"}],rotation:0,type:"",visible:!0,width:0,x:341.526275397425,y:948.672967850652},{height:0,id:7,name:"Stairs",point:!0,properties:[{name:"id",type:"string",value:"stairs"},{name:"levelName",type:"string",value:"level_2"}],rotation:0,type:"",visible:!0,width:0,x:1202.30788561211,y:247.937747564976},{height:0,id:8,name:"Crate",point:!0,properties:[{name:"id",type:"string",value:"crate"},{name:"inventory",type:"string",value:"health_potion_weak"}],rotation:0,type:"",visible:!0,width:0,x:370.617261554132,y:949.94792690583},{height:0,id:9,name:"Crate",point:!0,properties:[{name:"id",type:"string",value:"crate"},{name:"inventory",type:"string",value:""}],rotation:0,type:"",visible:!0,width:0,x:944.729776321084,y:725.333340842067},{height:0,id:11,name:"Crate",point:!0,properties:[{name:"id",type:"string",value:"crate"},{name:"inventory",type:"string",value:"health_potion_weak"}],rotation:0,type:"",visible:!0,width:0,x:943.603906892819,y:760.182468483655},{height:0,id:12,name:"Golbin",point:!0,properties:[{name:"id",type:"string",value:"goblin"}],rotation:0,type:"",visible:!0,width:0,x:340.545596044442,y:1083.26097831731},{height:0,id:14,name:"Fire",point:!0,properties:[{name:"id",type:"string",value:"campfire"}],rotation:0,type:"",visible:!0,width:0,x:658.781710294825,y:237.201980125518},{height:0,id:15,name:"Fire",point:!0,properties:[{name:"id",type:"string",value:"campfire"}],rotation:0,type:"",visible:!0,width:0,x:786.258618604088,y:238.296842869239},{height:0,id:16,name:"Fire",point:!0,properties:[{name:"id",type:"string",value:"campfire"}],rotation:0,type:"",visible:!0,width:0,x:910.850368936736,y:239.506471513245},{height:0,id:17,name:"Lantern",point:!0,properties:[{name:"id",type:"string",value:"lantern"}],rotation:0,type:"",visible:!0,width:0,x:209.265755413088,y:951.97774283295},{height:0,id:18,name:"Golbin",point:!0,properties:[{name:"id",type:"string",value:"goblin"}],rotation:0,type:"",visible:!0,width:0,x:949.558485544938,y:145.155437280755},{height:0,id:19,name:"Golbin",point:!0,properties:[{name:"id",type:"string",value:"goblin"}],rotation:0,type:"",visible:!0,width:0,x:622.958751663239,y:147.574694568767},{height:0,id:20,name:"Rat",point:!0,properties:[{name:"id",type:"string",value:"rat"}],rotation:0,type:"",visible:!0,width:0,x:244.344986089271,y:226.200556429176},{height:0,id:22,name:"Load Door",point:!0,properties:[{name:"id",type:"string",value:"load_door"},{name:"levelName",type:"string",value:"level_1"}],rotation:0,type:"",visible:!0,width:0,x:14.605418138987,y:723.203769140165},{height:0,id:29,name:"Door",point:!0,properties:[{name:"id",type:"string",value:"door"}],rotation:0,type:"",visible:!0,width:0,x:526.910048927362,y:728.264960481746}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:5,nextobjectid:30,orientation:"orthogonal",renderorder:"right-down",tiledversion:"1.3.4",tileheight:32,tilesets:[{firstgid:1,source:"../DungeonCrawl_ProjectUtumnoTileset.tsx"}],tilewidth:32,type:"map",version:1.2,width:70});var $jscomp=$jscomp||{};function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}$jscomp.scope={},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,i){t!=Array.prototype&&t!=Object.prototype&&(t[e]=i.value)},$jscomp.getGlobal=function(t){return"undefined"!=typeof window&&window===t?t:"undefined"!=typeof global&&null!=global?global:t},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(t,e,i,n){if(e){for(i=$jscomp.global,t=t.split("."),n=0;n<t.length-1;n++){var o=t[n];o in i||(i[o]={}),i=i[o]}(e=e(n=i[t=t[t.length-1]]))!=n&&null!=e&&$jscomp.defineProperty(i,t,{configurable:!0,writable:!0,value:e})}},$jscomp.polyfill("Array.prototype.fill",function(t){return t||function(t,e,i){var n=this.length||0;for(0>e&&(e=Math.max(0,n+e)),(null==i||i>n)&&(i=n),0>(i=Number(i))&&(i=Math.max(0,n+i)),e=Number(e||0);e<i;e++)this[e]=t;return this}},"es6","es3"),$jscomp.checkStringArgs=function(t,e,i){if(null==t)throw new TypeError("The 'this' value for String.prototype."+i+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+i+" must not be a regular expression");return t+""},$jscomp.polyfill("String.prototype.repeat",function(t){return t||function(t){var e=$jscomp.checkStringArgs(this,null,"repeat");if(0>t||1342177279<t)throw new RangeError("Invalid count value");t|=0;for(var i="";t;)1&t&&(i+=e),(t>>>=1)&&(e+=e);return i}},"es6","es3"),$jscomp.stringPadding=function(t,e){return t=void 0!==t?String(t):" ",0<e&&t?t.repeat(Math.ceil(e/t.length)).substring(0,e):""},$jscomp.polyfill("String.prototype.padStart",function(t){return t||function(t,e){var i=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(e,t-i.length)+i}},"es8","es3"),$jscomp.owns=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},$jscomp.assign="function"==typeof Object.assign?Object.assign:function(t,e){for(var i=1;i<arguments.length;i++){var n=arguments[i];if(n)for(var o in n)$jscomp.owns(n,o)&&(t[o]=n[o])}return t},$jscomp.polyfill("Object.assign",function(t){return t||$jscomp.assign},"es6","es3"),$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.Symbol=function(){var t=0;return function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+t++}}(),$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var t=$jscomp.global.Symbol.iterator;t||(t=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator")),"function"!=typeof Array.prototype[t]&&$jscomp.defineProperty(Array.prototype,t,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}}),$jscomp.initSymbolIterator=function(){}},$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var t=$jscomp.global.Symbol.asyncIterator;t||(t=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator")),$jscomp.initSymbolAsyncIterator=function(){}},$jscomp.arrayIterator=function(t){var e=0;return $jscomp.iteratorPrototype(function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}})},$jscomp.iteratorPrototype=function(t){return $jscomp.initSymbolIterator(),(t={next:t})[$jscomp.global.Symbol.iterator]=function(){return this},t},$jscomp.iteratorFromArray=function(t,e){$jscomp.initSymbolIterator(),t instanceof String&&(t+="");var i=0,n={next:function(){if(i<t.length){var o=i++;return{value:e(o,t[o]),done:!1}}return n.next=function(){return{done:!0,value:void 0}},n.next()}};return n[Symbol.iterator]=function(){return n},n},$jscomp.polyfill("Array.prototype.keys",function(t){return t||function(){return $jscomp.iteratorFromArray(this,function(t){return t})}},"es6","es3"),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.ROT={})}(this,function(t){function e(t,e){return(t%e+e)%e}function i(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),t<e?e:t>i?i:t}function n(t){return t.charAt(0).toUpperCase()+t.substring(1)}function o(t){for(var e=arguments.length,i=Array(1<e?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];var s=o.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(e,o,r,a){return"%"==t.charAt(a-1)?e.substring(1):i.length?(o=(r=(o||r).split(",")).shift()||"",(a=s[o.toLowerCase()])?(e=(e=i.shift())[a].apply(e,r),(o=o.charAt(0))!=o.toLowerCase()&&(e=n(e)),e):e):e})}function r(t){var e;if(t in T)var i=T[t];else{if("#"==t.charAt(0))if(3==(i=(t.match(/[0-9a-f]/gi)||[]).map(function(t){return parseInt(t,16)})).length)i=i.map(function(t){return 17*t});else for(e=0;3>e;e++)i[e+1]+=16*i[e],i.splice(e,1);else i=(e=t.match(/rgb\(([0-9, ]+)\)/i))?e[1].split(/\s*,\s*/).map(function(t){return parseInt(t)}):[0,0,0];T[t]=i}return i.slice()}function s(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(e=0;3>e;e++)for(n=0;n<i.length;n++)t[e]+=i[n][e];return t}function a(t,e,i){void 0===i&&(i=.5);for(var n=t.slice(),o=0;3>o;o++)n[o]=Math.round(n[o]+i*(e[o]-t[o]));return n}function l(t,e,i){void 0===i&&(i=.5),t=h(t),e=h(e);for(var n=0;3>n;n++)t[n]+=i*(e[n]-t[n]);return u(t)}function h(t){var e=t[0]/255,i=t[1]/255;t=t[2]/255;var n=Math.max(e,i,t),o=Math.min(e,i,t),r=0,s=(n+o)/2;if(n==o)o=0;else{var a=n-o;switch(o=.5<s?a/(2-n-o):a/(n+o),n){case e:r=(i-t)/a+(i<t?6:0);break;case i:r=(t-e)/a+2;break;case t:r=(e-i)/a+4}r/=6}return[r,o,s]}function c(t,e,i){return 0>i&&(i+=1),1<i&&--i,i<1/6?t+6*(e-t)*i:.5>i?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function u(t){var e=t[2];if(0==t[1])return[e=Math.round(255*e),e,e];var i=t[1],n=2*e-(i=.5>e?e*(1+i):e+i-e*i);e=c(n,i,t[0]+1/3);var o=c(n,i,t[0]);return t=c(n,i,t[0]-1/3),[Math.round(255*e),Math.round(255*o),Math.round(255*t)]}function p(t){return t=r(t),36*Math.floor(.0234375*t[0])+6*Math.floor(.0234375*t[1])+1*Math.floor(.0234375*t[2])+16}function g(t,e){var i=[],n=0;t.replace(I,function(e,o,r,s){var a=t.substring(n,s);return a.length&&i.push({type:0,value:a}),i.push({type:"c"==o?2:3,value:r.trim()}),n=s+e.length,""});var o=t.substring(n);return o.length&&i.push({type:0,value:o}),function(t,e){e||(e=1/0);for(var i=0,n=0,o=-1;i<t.length;){var r=t[i];if(1==r.type&&(n=0,o=-1),0!=r.type)i++;else{for(;0==n&&" "==r.value.charAt(0);)r.value=r.value.substring(1);var s=r.value.indexOf("\n");if(-1!=s){for(r.value=f(t,i,s,!0),s=r.value.split("");s.length&&" "==s[s.length-1];)s.pop();r.value=s.join("")}if(r.value.length){if(n+r.value.length>e){for(s=-1;;){var a=r.value.indexOf(" ",s+1);if(-1==a)break;if(n+a>e)break;s=a}-1!=s?r.value=f(t,i,s,!0):-1!=o?(i=t[o],r=i.value.lastIndexOf(" "),i.value=f(t,o,r,!0),i=o):r.value=f(t,i,e-n,!1)}else n+=r.value.length,-1!=r.value.indexOf(" ")&&(o=i);i++}else t.splice(i,1)}}for(t.push({type:1}),e=null,n=0;n<t.length;n++)switch(o=t[n],o.type){case 0:e=o;break;case 1:if(e){for(o=e.value.split("");o.length&&" "==o[o.length-1];)o.pop();e.value=o.join("")}e=null}return t.pop(),t}(i,e)}function f(t,e,i,n){return n={type:0,value:t[e].value.substring(i+(n?1:0))},t.splice(e+1,0,{type:1},n),t[e].value.substring(0,i)}function d(t,e,i){i[e[t+1]]=i[t],e[i[t]]=e[t+1],i[t]=t+1,e[t+1]=t}function _(t,e,i){i[e[t]]=i[t],e[i[t]]=e[t],i[t]=t,e[t]=t}var m=(new(function(){function t(){this._c=this._s2=this._s1=this._s0=this._seed=0}var e=t.prototype;return e.getSeed=function(){return this._seed},e.setSeed=function(t){return this._seed=t=1>t?1/t:t,this._s0=2.3283064365386963e-10*(t>>>0),t=69069*t+1>>>0,this._s1=2.3283064365386963e-10*t,this._s2=2.3283064365386963e-10*(69069*t+1>>>0),this._c=1,this},e.getUniform=function(){var t=2091639*this._s0+2.3283064365386963e-10*this._c;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c},e.getUniformInt=function(t,e){var i=Math.max(t,e);return t=Math.min(t,e),Math.floor(this.getUniform()*(i-t+1))+t},e.getNormal=function(t,e){void 0===t&&(t=0),void 0===e&&(e=1);do{var i=2*this.getUniform()-1,n=2*this.getUniform()-1;n=i*i+n*n}while(1<n||0==n);return t+i*Math.sqrt(-2*Math.log(n)/n)*e},e.getPercentage=function(){return 1+Math.floor(100*this.getUniform())},e.getItem=function(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null},e.shuffle=function(t){var e=[];for(t=t.slice();t.length;){var i=t.indexOf(this.getItem(t));e.push(t.splice(i,1)[0])}return e},e.getWeightedValue=function(t){var e,i=0;for(n in t)i+=t[n];i*=this.getUniform();var n=0;for(e in t)if(i<(n+=t[e]))break;return e},e.getState=function(){return[this._s0,this._s1,this._s2,this._c]},e.setState=function(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this},e.clone=function(){return(new t).setState(this.getState())},t}())).setSeed(Date.now()),y=function(){function t(){}var e=t.prototype;return e.getContainer=function(){return null},e.setOptions=function(t){this._options=t},t}(),v=function(t){function e(){var e=t.call(this)||this;return e._ctx=document.createElement("canvas").getContext("2d"),e}_inheritsLoose(e,t);var i=e.prototype;return i.schedule=function(t){requestAnimationFrame(t)},i.getContainer=function(){return this._ctx.canvas},i.setOptions=function(e){t.prototype.setOptions.call(this,e),e=(e.fontStyle?e.fontStyle+" ":"")+" "+e.fontSize+"px "+e.fontFamily,this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"},i.clear=function(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)},i.eventToPosition=function(t,e){var i=this._ctx.canvas,n=i.getBoundingClientRect();return t-=n.left,e-=n.top,t*=i.width/n.width,e*=i.height/n.height,0>t||0>e||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)},e}(y);o.map={s:"toString"};var b=Object.freeze({mod:e,clamp:i,capitalize:n,format:o}),w=function(t){function i(){var e=t.call(this)||this;return e._spacingX=0,e._spacingY=0,e._hexSize=0,e}_inheritsLoose(i,t);var n=i.prototype;return n.draw=function(t,e){var i=t[2],n=t[3],o=t[4];if(t=[(t[0]+1)*this._spacingX,t[1]*this._spacingY+this._hexSize],this._options.transpose&&t.reverse(),e&&(this._ctx.fillStyle=o,this._fill(t[0],t[1])),i)for(this._ctx.fillStyle=n,e=[].concat(i),i=0;i<e.length;i++)this._ctx.fillText(e[i],t[0],Math.ceil(t[1]))},n.computeSize=function(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]},n.computeFontSize=function(t,e){this._options.transpose&&(t+=e,t-=e=t-e),t=Math.min(2*t/((this._options.width+1)*Math.sqrt(3))-1,e/(2+1.5*(this._options.height-1))),e=this._ctx.font,this._ctx.font="100px "+this._options.fontFamily;var i=Math.ceil(this._ctx.measureText("W").width);return this._ctx.font=e,t=Math.floor(t)+1,Math.ceil(2*t/(this._options.spacing*(1+i/100/Math.sqrt(3))))-1},n._normalizedEventToPosition=function(t,i){if(this._options.transpose){t+=i,t-=i=t-i;var n=this._ctx.canvas.width}else n=this._ctx.canvas.height;return e(i=Math.floor(i/(n/this._options.height)),2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,i]},n._fill=function(t,e){var i=this._hexSize,n=this._options.border,o=this._ctx;o.beginPath(),this._options.transpose?(o.moveTo(t-i+n,e),o.lineTo(t-i/2+n,e+this._spacingX-n),o.lineTo(t+i/2-n,e+this._spacingX-n),o.lineTo(t+i-n,e),o.lineTo(t+i/2-n,e-this._spacingX+n),o.lineTo(t-i/2+n,e-this._spacingX+n),o.lineTo(t-i+n,e)):(o.moveTo(t,e-i+n),o.lineTo(t+this._spacingX-n,e-i/2+n),o.lineTo(t+this._spacingX-n,e+i/2-n),o.lineTo(t,e+i-n),o.lineTo(t-this._spacingX+n,e+i/2-n),o.lineTo(t-this._spacingX+n,e-i/2+n),o.lineTo(t,e-i+n)),o.fill()},n._updateSize=function(){var t=this._options,e=Math.ceil(this._ctx.measureText("W").width);if(this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose){e="height";var i="width"}else e="width",i="height";this._ctx.canvas[e]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[i]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)},i}(v),C=function(t){function e(){var e=t.call(this)||this;return e._spacingX=0,e._spacingY=0,e._canvasCache={},e}_inheritsLoose(e,t);var i=e.prototype;return i.setOptions=function(e){t.prototype.setOptions.call(this,e),this._canvasCache={}},i.draw=function(t,i){e.cache?this._drawWithCache(t):this._drawNoCache(t,i)},i._drawWithCache=function(t){var e=t[0],i=t[1],n=t[2],o=t[3],r=t[4];if((t=""+n+o+r)in this._canvasCache)var s=this._canvasCache[t];else{var a=this._options.border,l=(s=document.createElement("canvas")).getContext("2d");if(s.width=this._spacingX,s.height=this._spacingY,l.fillStyle=r,l.fillRect(a,a,s.width-a,s.height-a),n)for(l.fillStyle=o,l.font=this._ctx.font,l.textAlign="center",l.textBaseline="middle",n=[].concat(n),o=0;o<n.length;o++)l.fillText(n[o],this._spacingX/2,Math.ceil(this._spacingY/2));this._canvasCache[t]=s}this._ctx.drawImage(s,e*this._spacingX,i*this._spacingY)},i._drawNoCache=function(t,e){var i=t[0],n=t[1],o=t[2],r=t[3];if(t=t[4],e&&(e=this._options.border,this._ctx.fillStyle=t,this._ctx.fillRect(i*this._spacingX+e,n*this._spacingY+e,this._spacingX-e,this._spacingY-e)),o)for(this._ctx.fillStyle=r,o=[].concat(o),r=0;r<o.length;r++)this._ctx.fillText(o[r],(i+.5)*this._spacingX,Math.ceil((n+.5)*this._spacingY))},i.computeSize=function(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]},i.computeFontSize=function(t,e){t=Math.floor(t/this._options.width),e=Math.floor(e/this._options.height);var i=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;var n=Math.ceil(this._ctx.measureText("W").width);return this._ctx.font=i,1<(t=n/100*e/t)&&(e=Math.floor(e/t)),Math.floor(e/this._options.spacing)},i._normalizedEventToPosition=function(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]},i._updateSize=function(){var t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY},e}(v);C.cache=!1;var k=function(t){function e(){var e=t.call(this)||this;return e._colorCanvas=document.createElement("canvas"),e}_inheritsLoose(e,t);var i=e.prototype;return i.draw=function(t,e){var i=t[0],n=t[1],o=t[2],r=t[3],s=t[4];t=this._options.tileWidth;var a=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(i*t,n*a,t,a):(this._ctx.fillStyle=s,this._ctx.fillRect(i*t,n*a,t,a))),o)for(e=[].concat(o),r=[].concat(r),s=[].concat(s),o=0;o<e.length;o++){var l=this._options.tileMap[e[o]];if(!l)throw Error('Char "'+e[o]+'" not found in tileMap');if(this._options.tileColorize){var h=this._colorCanvas,c=h.getContext("2d");c.globalCompositeOperation="source-over",c.clearRect(0,0,t,a);var u=r[o],p=s[o];c.drawImage(this._options.tileSet,l[0],l[1],t,a,0,0,t,a),"transparent"!=u&&(c.fillStyle=u,c.globalCompositeOperation="source-atop",c.fillRect(0,0,t,a)),"transparent"!=p&&(c.fillStyle=p,c.globalCompositeOperation="destination-over",c.fillRect(0,0,t,a)),this._ctx.drawImage(h,i*t,n*a,t,a)}else this._ctx.drawImage(this._options.tileSet,l[0],l[1],t,a,i*t,n*a,t,a)}},i.computeSize=function(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]},i.computeFontSize=function(){throw Error("Tile backend does not understand font size")},i._normalizedEventToPosition=function(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]},i._updateSize=function(){var t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight},e}(v),T={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};v=Object.freeze({fromString:r,add:function(t){for(var e=t.slice(),i=arguments.length,n=Array(1<i?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];for(i=0;3>i;i++)for(o=0;o<n.length;o++)e[i]+=n[o][i];return e},add_:s,multiply:function(t){for(var e=t.slice(),i=arguments.length,n=Array(1<i?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];for(i=0;3>i;i++){for(o=0;o<n.length;o++)e[i]*=n[o][i]/255;e[i]=Math.round(e[i])}return e},multiply_:function(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(e=0;3>e;e++){for(n=0;n<i.length;n++)t[e]*=i[n][e]/255;t[e]=Math.round(t[e])}return t},interpolate:a,lerp:a,interpolateHSL:l,lerpHSL:l,randomize:function(t,e){e instanceof Array||(e=Math.round(m.getNormal(0,e))),t=t.slice();for(var i=0;3>i;i++)t[i]+=e instanceof Array?Math.round(m.getNormal(0,e[i])):e;return t},rgb2hsl:h,hsl2rgb:u,toRGB:function(t){return"rgb("+t.map(function(t){return i(t,0,255)}).join(",")+")"},toHex:function(t){return"#"+t.map(function(t){return i(t,0,255).toString(16).padStart(2,"0")}).join("")}});var x=function(t){function e(){var e=t.call(this)||this;return e._offset=[0,0],e._cursor=[-1,-1],e._lastColor="",e}_inheritsLoose(e,t);var i=e.prototype;return i.schedule=function(t){setTimeout(t,1e3/60)},i.setOptions=function(e){t.prototype.setOptions.call(this,e);var i=[e.width,e.height];this._offset=this.computeSize().map(function(t,e){return Math.floor((t-i[e])/2)})},i.clear=function(){process.stdout.write("[0;48;5;"+p(this._options.bg)+"m[2J")},i.draw=function(t,e){var i=t[2],n=t[3],o=t[4],r=this._offset[0]+t[0],s=this._offset[1]+t[1];t=this.computeSize(),0>r||r>=t[0]||0>s||s>=t[1]||(r===this._cursor[0]&&s===this._cursor[1]||(process.stdout.write("["+(s+1)+";"+(r+1)+"H"),this._cursor[0]=r,this._cursor[1]=s),e&&(i||(i=" ")),i&&((e="[0;38;5;"+p(n)+";48;5;"+p(o)+"m")!==this._lastColor&&(process.stdout.write(e),this._lastColor=e),i=[].concat(i),process.stdout.write(i[0]),this._cursor[0]++,this._cursor[0]>=t[0]&&(this._cursor[0]=0,this._cursor[1]++)))},i.computeFontSize=function(){throw Error("Terminal backend has no notion of font size")},i.eventToPosition=function(t,e){return[t,e]},i.computeSize=function(){return[process.stdout.columns,process.stdout.rows]},e}(y),I=/%([bc]){([^}]*)}/g;y=Object.freeze({TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(t,e){var i={width:0,height:1};t=g(t,e);for(var n=e=0;n<t.length;n++){var o=t[n];switch(o.type){case 0:e+=o.value.length;break;case 1:i.height++,i.width=Math.max(i.width,e),e=0}}return i.width=Math.max(i.width,e),i},tokenize:g});var O={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},S={hex:w,rect:C,tile:k,term:x},L={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1},M=function(){function t(t){void 0===t&&(t={}),this._data={},this._dirty=!1,this._options={},t=Object.assign({},L,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}var e=t.prototype;return e.DEBUG=function(t,e,i){var n=[this._options.bg,this._options.fg];this.draw(t,e,null,null,n[i%n.length])},e.clear=function(){this._data={},this._dirty=!0},e.setOptions=function(t){return Object.assign(this._options,t),(t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout)&&(t.layout&&(this._backend=new S[t.layout]),this._backend.setOptions(this._options),this._dirty=!0),this},e.getOptions=function(){return this._options},e.getContainer=function(){return this._backend.getContainer()},e.computeSize=function(t,e){return this._backend.computeSize(t,e)},e.computeFontSize=function(t,e){return this._backend.computeFontSize(t,e)},e.computeTileSize=function(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]},e.eventToPosition=function(t){if("touches"in t){var e=t.touches[0].clientX;t=t.touches[0].clientY}else e=t.clientX,t=t.clientY;return this._backend.eventToPosition(e,t)},e.draw=function(t,e,i,n,o){n||(n=this._options.fg),o||(o=this._options.bg);var r=t+","+e;this._data[r]=[t,e,i,n,o],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[r]=!0)},e.drawText=function(t,e,i,n){var o=null,r=null,s=t,a=1;for(n||(n=this._options.width-t),i=g(i,n);i.length;)switch(n=i.shift(),n.type){case 0:for(var l,h,c=!1,u=!1,p=0;p<n.value.length;p++){l=n.value.charCodeAt(p);var f=n.value.charAt(p);h=65280<l&&65377>l||65500<l&&65512>l||65518<l,l=32==f.charCodeAt(0)||12288==f.charCodeAt(0),!u||h||l||s++,h&&!c&&s++,this.draw(s++,e,f,o,r),c=l,u=h}break;case 2:o=n.value||null;break;case 3:r=n.value||null;break;case 1:s=t,e++,a++}return a},e._tick=function(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty)for(var t in this._backend.clear(),this._data)this._draw(t,!1);else for(var e in this._dirty)this._draw(e,!0);this._dirty=!1}},e._draw=function(t,e){(t=this._data[t])[4]!=this._options.bg&&(e=!0),this._backend.draw(t,e)},t}();M.Rect=C,M.Hex=w,M.Tile=k,M.Term=x,w=function(){function t(t){for(this._options={words:!1,order:3,prior:.001},Object.assign(this._options,t),this._suffix=this._boundary=String.fromCharCode(0),this._prefix=[],t=0;t<this._options.order;t++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}}var e=t.prototype;return e.clear=function(){this._data={},this._priorValues={}},e.generate=function(){for(var t=[this._sample(this._prefix)];t[t.length-1]!=this._boundary;)t.push(this._sample(t));return this._join(t.slice(0,-1))},e.observe=function(t){t=this._split(t);for(var e=0;e<t.length;e++)this._priorValues[t[e]]=this._options.prior;for(t=this._prefix.concat(t).concat(this._suffix),e=this._options.order;e<t.length;e++)for(var i=t.slice(e-this._options.order,e),n=t[e],o=0;o<i.length;o++){var r=i.slice(o);this._observeEvent(r,n)}},e.getStats=function(){var t=[],e=Object.keys(this._priorValues).length;e--,t.push("distinct samples: "+e),e=Object.keys(this._data).length;var i,n=0;for(i in this._data)n+=Object.keys(this._data[i]).length;return t.push("dictionary size (contexts): "+e),t.push("dictionary size (events): "+n),t.join(", ")},e._split=function(t){return t.split(this._options.words?/\s+/:"")},e._join=function(t){return t.join(this._options.words?" ":"")},e._observeEvent=function(t,e){(t=this._join(t))in this._data||(this._data[t]={}),e in(t=this._data[t])||(t[e]=0),t[e]++},e._sample=function(t){t=this._backoff(t),t=this._join(t),t=this._data[t];var e={};if(this._options.prior){for(var i in this._priorValues)e[i]=this._priorValues[i];for(var n in t)e[n]+=t[n]}else e=t;return m.getWeightedValue(e)},e._backoff=function(t){for(t.length>this._options.order?t=t.slice(-this._options.order):t.length<this._options.order&&(t=this._prefix.slice(0,this._options.order-t.length).concat(t));!(this._join(t)in this._data)&&0<t.length;)t=t.slice(1);return t},t}();var D=function(){function t(){this._time=0,this._events=[],this._eventTimes=[]}var e=t.prototype;return e.getTime=function(){return this._time},e.clear=function(){return this._events=[],this._eventTimes=[],this},e.add=function(t,e){for(var i=this._events.length,n=0;n<this._eventTimes.length;n++)if(this._eventTimes[n]>e){i=n;break}this._events.splice(i,0,t),this._eventTimes.splice(i,0,e)},e.get=function(){if(!this._events.length)return null;var t=this._eventTimes.splice(0,1)[0];if(0<t){this._time+=t;for(var e=0;e<this._eventTimes.length;e++)this._eventTimes[e]-=t}return this._events.splice(0,1)[0]},e.getEventTime=function(t){if(-1!=(t=this._events.indexOf(t)))return this._eventTimes[t]},e.remove=function(t){return-1!=(t=this._events.indexOf(t))&&(this._remove(t),!0)},e._remove=function(t){this._events.splice(t,1),this._eventTimes.splice(t,1)},t}();C={Simple:C=function(t){function e(){return t.apply(this,arguments)||this}_inheritsLoose(e,t);var i=e.prototype;return i.add=function(e,i){return this._queue.add(e,0),t.prototype.add.call(this,e,i)},i.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),t.prototype.next.call(this)},e}(x=function(){function t(){this._queue=new D,this._repeat=[],this._current=null}var e=t.prototype;return e.getTime=function(){return this._queue.getTime()},e.add=function(t,e){return e&&this._repeat.push(t),this},e.getTimeOf=function(t){return this._queue.getEventTime(t)},e.clear=function(){return this._queue.clear(),this._repeat=[],this._current=null,this},e.remove=function(t){var e=this._queue.remove(t),i=this._repeat.indexOf(t);return-1!=i&&this._repeat.splice(i,1),this._current==t&&(this._current=null),e},e.next=function(){return this._current=this._queue.get()},t}()),Speed:k=function(t){function e(){return t.apply(this,arguments)||this}_inheritsLoose(e,t);var i=e.prototype;return i.add=function(e,i,n){return this._queue.add(e,void 0!==n?n:1/e.getSpeed()),t.prototype.add.call(this,e,i)},i.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),t.prototype.next.call(this)},e}(x),Action:x=function(t){function e(){var e=t.call(this)||this;return e._defaultDuration=1,e._duration=e._defaultDuration,e}_inheritsLoose(e,t);var i=e.prototype;return i.add=function(e,i,n){return this._queue.add(e,n||this._defaultDuration),t.prototype.add.call(this,e,i)},i.clear=function(){return this._duration=this._defaultDuration,t.prototype.clear.call(this)},i.remove=function(e){return e==this._current&&(this._duration=this._defaultDuration),t.prototype.remove.call(this,e)},i.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),t.prototype.next.call(this)},i.setDuration=function(t){return this._current&&(this._duration=t),this},e}(x)};var E=function(){function t(t,e){void 0===e&&(e={}),this._lightPasses=t,this._options=Object.assign({topology:8},e)}return t.prototype._getCircle=function(t,e,i){var n=[];switch(this._options.topology){case 4:var o=1,r=[0,1],s=[O[8][7],O[8][1],O[8][3],O[8][5]];break;case 6:s=O[6],o=1,r=[-1,1];break;case 8:s=O[4],o=2,r=[-1,1];break;default:throw Error("Incorrect topology for FOV computation")}for(t+=r[0]*i,e+=r[1]*i,r=0;r<s.length;r++)for(var a=0;a<i*o;a++)n.push([t,e]),t+=s[r][0],e+=s[r][1];return n},t}();k=function(t){function e(){return t.apply(this,arguments)||this}_inheritsLoose(e,t);var i=e.prototype;return i.compute=function(t,e,i,n){if(n(t,e,0,1),this._lightPasses(t,e))for(var o,r,s,a,l,h=[],c=1;c<=i;c++)for(var u=this._getCircle(t,e,c),p=360/u.length,g=0;g<u.length;g++)if(s=u[g][0],a=u[g][1],r=(o=p*(g-.5))+p,l=!this._lightPasses(s,a),this._visibleCoords(Math.floor(o),Math.ceil(r),l,h)&&n(s,a,c,1),2==h.length&&0==h[0]&&360==h[1])return},i._visibleCoords=function(t,e,i,n){if(0>t)return e=this._visibleCoords(0,e,i,n),t=this._visibleCoords(360+t,360,i,n),e||t;for(var o=0;o<n.length&&n[o]<t;)o++;if(o==n.length)return i&&n.push(t,e),!0;var r=0;if(o%2){for(;o<n.length&&n[o]<e;)o++,r++;if(0==r)return!1;i&&(r%2?n.splice(o-r,r,e):n.splice(o-r,r))}else{for(;o<n.length&&n[o]<e;)o++,r++;if(t==n[o-r]&&1==r)return!1;i&&(r%2?n.splice(o-r,r,t):n.splice(o-r,r,t,e))}return!0},e}(E),x=function(t){function e(){return t.apply(this,arguments)||this}_inheritsLoose(e,t);var i=e.prototype;return i.compute=function(t,e,i,n){if(n(t,e,0,1),this._lightPasses(t,e))for(var o,r,s,a,l,h=[],c=1;c<=i;c++)for(var u=this._getCircle(t,e,c),p=u.length,g=0;g<p;g++)if(o=u[g][0],r=u[g][1],a=[g?2*g-1:2*p-1,2*p],l=[2*g+1,2*p],s=!this._lightPasses(o,r),(s=this._checkVisibility(a,l,s,h))&&n(o,r,c,s),2==h.length&&0==h[0][0]&&h[1][0]==h[1][1])return},i._checkVisibility=function(t,e,i,n){if(t[0]>e[0])return((t=this._checkVisibility(t,[t[1],t[1]],i,n))+(e=this._checkVisibility([0,1],e,i,n)))/2;for(var o=0,r=!1;o<n.length;){var s=n[o];if(0<=(s=s[0]*t[1]-t[0]*s[1])){0!=s||o%2||(r=!0);break}o++}s=n.length;for(var a=!1;s--;){var l=n[s];if(0<=(l=e[0]*l[1]-l[0]*e[1])){0==l&&s%2&&(a=!0);break}}if(l=!0,o==s&&(r||a)?l=!1:r&&a&&o+1==s&&s%2?l=!1:o>s&&o%2&&(l=!1),!l)return 0;if((r=s-o+1)%2)o%2?(s=n[o],s=(e[0]*s[1]-s[0]*e[1])/(s[1]*e[1]),i&&n.splice(o,r,e)):(s=((s=n[s])[0]*t[1]-t[0]*s[1])/(t[1]*s[1]),i&&n.splice(o,r,t));else{if(!(o%2))return i&&n.splice(o,r,t,e),1;a=n[o],s=((s=n[s])[0]*a[1]-a[0]*s[1])/(a[1]*s[1]),i&&n.splice(o,r)}return s/((e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]))},e}(E);var A=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];k={DiscreteShadowcasting:k,PreciseShadowcasting:x,RecursiveShadowcasting:E=function(t){function e(){return t.apply(this,arguments)||this}_inheritsLoose(e,t);var i=e.prototype;return i.compute=function(t,e,i,n){n(t,e,0,1);for(var o=0;o<A.length;o++)this._renderOctant(t,e,A[o],i,n)},i.compute180=function(t,e,i,n,o){o(t,e,0,1);var r=(n-1+8)%8,s=(n+1+8)%8;this._renderOctant(t,e,A[(n-2+8)%8],i,o),this._renderOctant(t,e,A[r],i,o),this._renderOctant(t,e,A[n],i,o),this._renderOctant(t,e,A[s],i,o)},i.compute90=function(t,e,i,n,o){o(t,e,0,1);var r=(n-1+8)%8;this._renderOctant(t,e,A[n],i,o),this._renderOctant(t,e,A[r],i,o)},i._renderOctant=function(t,e,i,n,o){this._castVisibility(t,e,1,1,0,n+1,i[0],i[1],i[2],i[3],o)},i._castVisibility=function(t,e,i,n,o,r,s,a,l,h,c){if(!(n<o))for(;i<=r;i++){for(var u=-i-1,p=-i,g=!1,f=0;0>=u;){var d=t+(u+=1)*s+p*a,_=e+u*l+p*h,m=(u-.5)/(p+.5),y=(u+.5)/(p-.5);if(!(y>n)){if(m<o)break;u*u+p*p<r*r&&c(d,_,i,1),g?this._lightPasses(d,_)?(g=!1,n=f):f=y:!this._lightPasses(d,_)&&i<r&&(g=!0,this._castVisibility(t,e,i+1,n,m,r,s,a,l,h,c),f=y)}}if(g)break}},e}(E)},x=function(t){function e(){return t.apply(this,arguments)||this}return _inheritsLoose(e,t),e.prototype.create=function(t){for(var e=this._width-1,i=this._height-1,n=0;n<=e;n++)for(var o=0;o<=i;o++)t(n,o,n&&o&&n<e&&o<i?0:1);return this},e}(E=function(){function t(t,e){void 0===t&&(t=80),void 0===e&&(e=25),this._width=t,this._height=e}return t.prototype._fillMap=function(t){for(var e=[],i=0;i<this._width;i++){e.push([]);for(var n=0;n<this._height;n++)e[i].push(t)}return e},t}());var R=function(t){function e(e,i){return(e=t.call(this,e,i)||this)._rooms=[],e._corridors=[],e}_inheritsLoose(e,t);var i=e.prototype;return i.getRooms=function(){return this._rooms},i.getCorridors=function(){return this._corridors},e}(E),G=function(){},V=function(t){function e(e,i,n,o,r,s){var a=t.call(this)||this;return a._x1=e,a._y1=i,a._x2=n,a._y2=o,a._doors={},void 0!==r&&void 0!==s&&a.addDoor(r,s),a}_inheritsLoose(e,t),e.createRandomAt=function(t,e,i,n,o){var r=o.roomWidth[0],s=o.roomWidth[1],a=m.getUniformInt(r,s);if(r=o.roomHeight[0],s=o.roomHeight[1],o=m.getUniformInt(r,s),1==i)return new this(t+1,i=e-Math.floor(m.getUniform()*o),t+a,i+o-1,t,e);if(-1==i)return new this(t-a,i=e-Math.floor(m.getUniform()*o),t-1,i+o-1,t,e);if(1==n)return new this(i=t-Math.floor(m.getUniform()*a),e+1,i+a-1,e+o,t,e);if(-1==n)return new this(i=t-Math.floor(m.getUniform()*a),e-o,i+a-1,e-1,t,e);throw Error("dx or dy must be 1 or -1")},e.createRandomCenter=function(t,e,i){var n=i.roomWidth[0],o=i.roomWidth[1],r=m.getUniformInt(n,o);return n=i.roomHeight[0],o=i.roomHeight[1],i=m.getUniformInt(n,o),new this(t-=Math.floor(m.getUniform()*r),e-=Math.floor(m.getUniform()*i),t+r-1,e+i-1)},e.createRandom=function(t,e,i){var n=i.roomWidth[0],o=i.roomWidth[1],r=m.getUniformInt(n,o);return n=i.roomHeight[0],o=i.roomHeight[1],t=t-r-1,e=e-(i=m.getUniformInt(n,o))-1,new this(t=1+Math.floor(m.getUniform()*t),e=1+Math.floor(m.getUniform()*e),t+r-1,e+i-1)};var i=e.prototype;return i.addDoor=function(t,e){return this._doors[t+","+e]=1,this},i.getDoors=function(t){for(var e in this._doors){var i=e.split(",");t(parseInt(i[0]),parseInt(i[1]))}return this},i.clearDoors=function(){return this._doors={},this},i.addDoors=function(t){for(var e=this._x1-1,i=this._x2+1,n=this._y1-1,o=this._y2+1,r=e;r<=i;r++)for(var s=n;s<=o;s++)r!=e&&r!=i&&s!=n&&s!=o||t(r,s)||this.addDoor(r,s);return this},i.debug=function(){console.log("room",this._x1,this._y1,this._x2,this._y2)},i.isValid=function(t,e){for(var i=this._x1-1,n=this._x2+1,o=this._y1-1,r=this._y2+1,s=i;s<=n;s++)for(var a=o;a<=r;a++)if(s==i||s==n||a==o||a==r){if(!t(s,a))return!1}else if(!e(s,a))return!1;return!0},i.create=function(t){for(var e=this._x1-1,i=this._x2+1,n=this._y1-1,o=this._y2+1,r=e;r<=i;r++)for(var s=n;s<=o;s++)t(r,s,r+","+s in this._doors?2:r==e||r==i||s==n||s==o?1:0)},i.getCenter=function(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]},i.getLeft=function(){return this._x1},i.getRight=function(){return this._x2},i.getTop=function(){return this._y1},i.getBottom=function(){return this._y2},e}(G),K=function(t){function e(e,i,n,o){var r=t.call(this)||this;return r._startX=e,r._startY=i,r._endX=n,r._endY=o,r._endsWithAWall=!0,r}_inheritsLoose(e,t),e.createRandomAt=function(t,e,i,n,o){return new this(t,e,t+i*(o=m.getUniformInt(o.corridorLength[0],o.corridorLength[1])),e+n*o)};var i=e.prototype;return i.debug=function(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)},i.isValid=function(t,e){var i=this._startX,n=this._startY,o=this._endX-i,r=this._endY-n,s=1+Math.max(Math.abs(o),Math.abs(r));o&&(o/=Math.abs(o)),r&&(r/=Math.abs(r));for(var a=r,l=-o,h=!0,c=0;c<s;c++){var u=i+c*o,p=n+c*r;if(e(u,p)||(h=!1),t(u+a,p+l)||(h=!1),t(u-a,p-l)||(h=!1),!h){s=c,this._endX=u-o,this._endY=p-r;break}}return!(0==s||1==s&&t(this._endX+o,this._endY+r))&&(e=!t(this._endX+o+a,this._endY+r+l),a=!t(this._endX+o-a,this._endY+r-l),this._endsWithAWall=t(this._endX+o,this._endY+r),!e&&!a||!this._endsWithAWall)},i.create=function(t){var e=this._startX,i=this._startY,n=this._endX-e,o=this._endY-i,r=1+Math.max(Math.abs(n),Math.abs(o));n&&(n/=Math.abs(n)),o&&(o/=Math.abs(o));for(var s=0;s<r;s++)t(e+s*n,i+s*o,0);return!0},i.createPriorityWalls=function(t){if(this._endsWithAWall){var e=this._endX-this._startX,i=this._endY-this._startY;e&&(e/=Math.abs(e)),i&&(i/=Math.abs(i));var n=i,o=-e;t(this._endX+e,this._endY+i),t(this._endX+n,this._endY+o),t(this._endX-n,this._endY-o)}},e}(G);G=function(t){function e(e,i,n){return(e=t.call(this,e,i)||this)._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(e._options,n),e._map=[],e._dug=0,e._roomAttempts=20,e._corridorAttempts=20,e._connected=[],e._unconnected=[],e._digCallback=e._digCallback.bind(_assertThisInitialized(_assertThisInitialized(e))),e._canBeDugCallback=e._canBeDugCallback.bind(_assertThisInitialized(_assertThisInitialized(e))),e._isWallCallback=e._isWallCallback.bind(_assertThisInitialized(_assertThisInitialized(e))),e}_inheritsLoose(e,t);var i=e.prototype;return i.create=function(t){for(var e=Date.now();;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(2>this._rooms.length)&&this._generateCorridors())break}if(t)for(e=0;e<this._width;e++)for(var i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this},i._generateRooms=function(){var t=this._width-2,e=this._height-2;do{var i=this._generateRoom();if(this._dug/(t*e)>this._options.roomDugPercentage)break}while(i)},i._generateRoom=function(){for(var t=0;t<this._roomAttempts;){t++;var e=V.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null},i._generateCorridors=function(){for(var t=0;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(var e=0;e<this._rooms.length;e++){var i=this._rooms[e];i.clearDoors(),i.create(this._digCallback)}for(this._unconnected=m.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());(e=m.getItem(this._connected))&&(e=this._closestRoom(this._unconnected,e))&&(i=this._closestRoom(this._connected,e))&&this._connectRooms(e,i);)if(!this._unconnected.length)return!0}return!1},i._closestRoom=function(t,e){var i=1/0;e=e.getCenter();for(var n=null,o=0;o<t.length;o++){var r=t[o],s=r.getCenter(),a=s[0]-e[0];(a=a*a+(s=s[1]-e[1])*s)<i&&(i=a,n=r)}return n},i._connectRooms=function(t,e){var i=t.getCenter(),n=e.getCenter(),o=n[0]-i[0];if(i=n[1]-i[1],Math.abs(o)<Math.abs(i)){var r=((o=0<i?2:0)+2)%4,s=e.getLeft(),a=e.getRight();i=0}else r=((o=0<o?1:3)+2)%4,s=e.getTop(),a=e.getBottom(),i=1;if(!(o=this._placeInWall(t,o)))return!1;if(o[i]>=s&&o[i]<=a){switch(n=o.slice(),s=0,r){case 0:s=e.getTop()-1;break;case 1:s=e.getRight()+1;break;case 2:s=e.getBottom()+1;break;case 3:s=e.getLeft()-1}n[(i+1)%2]=s,this._digLine([o,n])}else if(o[i]<s-1||o[i]>a+1){switch(n=o[i]-n[i],s=0,r){case 0:case 1:s=0>n?3:1;break;case 2:case 3:s=0>n?1:3}if(!(n=this._placeInWall(e,(r+s)%4)))return!1;(r=[0,0])[i]=o[i],r[i=(i+1)%2]=n[i],this._digLine([o,r,n])}else{if(s=(i+1)%2,!(n=this._placeInWall(e,r)))return!1;r=Math.round((n[s]+o[s])/2);var l=[0,0];(a=[0,0])[i]=o[i],a[s]=r,l[i]=n[i],l[s]=r,this._digLine([o,a,l,n])}return t.addDoor(o[0],o[1]),e.addDoor(n[0],n[1]),-1!=(i=this._unconnected.indexOf(t))&&(this._unconnected.splice(i,1),this._connected.push(t)),-1!=(i=this._unconnected.indexOf(e))&&(this._unconnected.splice(i,1),this._connected.push(e)),!0},i._placeInWall=function(t,e){var i=[0,0],n=[0,0],o=0;switch(e){case 0:n=[1,0],i=[t.getLeft(),t.getTop()-1],o=t.getRight()-t.getLeft()+1;break;case 1:n=[0,1],i=[t.getRight()+1,t.getTop()],o=t.getBottom()-t.getTop()+1;break;case 2:n=[1,0],i=[t.getLeft(),t.getBottom()+1],o=t.getRight()-t.getLeft()+1;break;case 3:n=[0,1],i=[t.getLeft()-1,t.getTop()],o=t.getBottom()-t.getTop()+1}t=[],e=-2;for(var r=0;r<o;r++){var s=i[0]+r*n[0],a=i[1]+r*n[1];t.push(null),1==this._map[s][a]?e!=r-1&&(t[r]=[s,a]):(e=r)&&(t[r-1]=null)}for(i=t.length-1;0<=i;i--)t[i]||t.splice(i,1);return t.length?m.getItem(t):null},i._digLine=function(t){for(var e=1;e<t.length;e++){var i=t[e-1],n=t[e];(i=new K(i[0],i[1],n[0],n[1])).create(this._digCallback),this._corridors.push(i)}},i._digCallback=function(t,e,i){this._map[t][e]=i,0==i&&this._dug++},i._isWallCallback=function(t,e){return!(0>t||0>e||t>=this._width||e>=this._height)&&1==this._map[t][e]},i._canBeDugCallback=function(t,e){return!(1>t||1>e||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]},e}(R);var H=function(t){function e(e,i,n){return void 0===n&&(n={}),(e=t.call(this,e,i)||this)._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},e.setOptions(n),e._dirs=O[e._options.topology],e._map=e._fillMap(0),e}_inheritsLoose(e,t);var i=e.prototype;return i.randomize=function(t){for(var e=0;e<this._width;e++)for(var i=0;i<this._height;i++)this._map[e][i]=m.getUniform()<t?1:0;return this},i.setOptions=function(t){Object.assign(this._options,t)},i.set=function(t,e,i){this._map[t][e]=i},i.create=function(t){for(var e=this._fillMap(0),i=this._options.born,n=this._options.survive,o=0;o<this._height;o++){var r=1,s=0;for(6==this._options.topology&&(r=2,s=o%2);s<this._width;s+=r){var a=this._map[s][o],l=this._getNeighbors(s,o);a&&-1!=n.indexOf(l)?e[s][o]=1:a||-1==i.indexOf(l)||(e[s][o]=1)}}this._map=e,t&&this._serviceCallback(t)},i._serviceCallback=function(t){for(var e=0;e<this._height;e++){var i=1,n=0;for(6==this._options.topology&&(i=2,n=e%2);n<this._width;n+=i)t(n,e,this._map[n][e])}},i._getNeighbors=function(t,e){for(var i=0,n=0;n<this._dirs.length;n++){var o=this._dirs[n],r=t+o[0];o=e+o[1],0>r||r>=this._width||0>o||o>=this._height||(i+=1==this._map[r][o]?1:0)}return i},i.connect=function(t,e,i){e||(e=0);var n=[],o={},r=1,s=[0,0];6==this._options.topology&&(r=2,s=[0,1]);for(var a=0;a<this._height;a++)for(var l=s[a%2];l<this._width;l+=r)if(this._freeSpace(l,a,e)){var h=[l,a];o[this._pointKey(h)]=h,n.push([l,a])}for(r=n[m.getUniformInt(0,n.length-1)],(n={})[s=this._pointKey(r)]=r,delete o[s],this._findConnected(n,o,[r],!1,e);0<Object.keys(o).length;)for(var c in r=(s=this._getFromTo(n,o))[0],a=s[1],(s={})[this._pointKey(r)]=r,this._findConnected(s,o,[r],!0,e),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,a,r,n,o,e,i),s)r=s[c],this._map[r[0]][r[1]]=e,n[c]=r,delete o[c];t&&this._serviceCallback(t)},i._getFromTo=function(t,e){for(var i=[0,0],n=[0,0],o=Object.keys(t),r=Object.keys(e),s=0;5>s&&(o.length<r.length?(n=t[(i=o)[m.getUniformInt(0,i.length-1)]],i=this._getClosest(n,e)):(i=e[(i=r)[m.getUniformInt(0,i.length-1)]],n=this._getClosest(i,t)),!(64>(i[0]-n[0])*(i[0]-n[0])+(i[1]-n[1])*(i[1]-n[1])));s++);return[i,n]},i._getClosest=function(t,e){var i,n=null,o=null;for(i in e){var r=e[i],s=(r[0]-t[0])*(r[0]-t[0])+(r[1]-t[1])*(r[1]-t[1]);(null==o||s<o)&&(o=s,n=r)}return n},i._findConnected=function(t,e,i,n,o){for(;0<i.length;){var r=i.splice(0,1)[0];r=6==this._options.topology?[[r[0]+2,r[1]],[r[0]+1,r[1]-1],[r[0]-1,r[1]-1],[r[0]-2,r[1]],[r[0]-1,r[1]+1],[r[0]+1,r[1]+1]]:[[r[0]+1,r[1]],[r[0]-1,r[1]],[r[0],r[1]+1],[r[0],r[1]-1]];for(var s=0;s<r.length;s++){var a=this._pointKey(r[s]);null==t[a]&&this._freeSpace(r[s][0],r[s][1],o)&&(t[a]=r[s],n||delete e[a],i.push(r[s]))}}},i._tunnelToConnected=function(t,e,i,n,o,r){if(e[0]<t[0])var s=e,a=t;else s=t,a=e;for(var l=s[0];l<=a[0];l++){this._map[l][s[1]]=o;var h=[l,s[1]],c=this._pointKey(h);i[c]=h,delete n[c]}for(r&&s[0]<a[0]&&r(s,[a[0],s[1]]),l=a[0],e[1]<t[1]?(s=e,a=t):(s=t,a=e),t=s[1];t<a[1];t++)this._map[l][t]=o,e=[l,t],i[h=this._pointKey(e)]=e,delete n[h];r&&s[1]<a[1]&&r([a[0],s[1]],[a[0],a[1]])},i._tunnelToConnected6=function(t,e,i,n,o,r){if(e[0]<t[0])var s=e,a=t;else s=t,a=e;var l=s[0];for(s=s[1];l!=a[0]||s!=a[1];){var h=2;s<a[1]?(s++,h=1):s>a[1]&&(s--,h=1),l=l<a[0]?l+h:l>a[0]?l-h:a[1]%2?l-h:l+h,this._map[l][s]=o,h=[l,s];var c=this._pointKey(h);i[c]=h,delete n[c]}r&&r(e,t)},i._freeSpace=function(t,e,i){return 0<=t&&t<this._width&&0<=e&&e<this._height&&this._map[t][e]==i},i._pointKey=function(t){return t[0]+"."+t[1]},e}(E),W={room:V,corridor:K};x={Arena:x,Uniform:G,Cellular:H,Digger:R=function(t){function e(e,i,n){return void 0===n&&(n={}),(e=t.call(this,e,i)||this)._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},n),e._features={room:4,corridor:4},e._map=[],e._featureAttempts=20,e._walls={},e._dug=0,e._digCallback=e._digCallback.bind(_assertThisInitialized(_assertThisInitialized(e))),e._canBeDugCallback=e._canBeDugCallback.bind(_assertThisInitialized(_assertThisInitialized(e))),e._isWallCallback=e._isWallCallback.bind(_assertThisInitialized(_assertThisInitialized(e))),e._priorityWallCallback=e._priorityWallCallback.bind(_assertThisInitialized(_assertThisInitialized(e))),e}_inheritsLoose(e,t);var i=e.prototype;return i.create=function(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;var e=(this._width-2)*(this._height-2);this._firstRoom();var i=Date.now();do{var n=0;if(Date.now()-i>this._options.timeLimit)break;var o=this._findWall();if(!o)break;var r=o.split(",");o=parseInt(r[0]),r=parseInt(r[1]);var s=this._getDiggingDirection(o,r);if(s){var a=0;do{if(a++,this._tryFeature(o,r,s[0],s[1])){this._removeSurroundingWalls(o,r),this._removeSurroundingWalls(o-s[0],r-s[1]);break}}while(a<this._featureAttempts);for(var l in this._walls)1<this._walls[l]&&n++}}while(this._dug/e<this._options.dugPercentage||n);if(this._addDoors(),t)for(e=0;e<this._width;e++)for(i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this._walls={},this._map=[],this},i._digCallback=function(t,e,i){0==i||2==i?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1},i._isWallCallback=function(t,e){return!(0>t||0>e||t>=this._width||e>=this._height)&&1==this._map[t][e]},i._canBeDugCallback=function(t,e){return!(1>t||1>e||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]},i._priorityWallCallback=function(t,e){this._walls[t+","+e]=2},i._firstRoom=function(){var t=V.createRandomCenter(Math.floor(this._width/2),Math.floor(this._height/2),this._options);this._rooms.push(t),t.create(this._digCallback)},i._findWall=function(){var t,e=[],i=[];for(t in this._walls)2==this._walls[t]?i.push(t):e.push(t);return(e=i.length?i:e).length?(e=m.getItem(e.sort()),delete this._walls[e],e):null},i._tryFeature=function(t,e,i,n){var o=m.getWeightedValue(this._features);return!!(t=W[o].createRandomAt(t,e,i,n,this._options)).isValid(this._isWallCallback,this._canBeDugCallback)&&(t.create(this._digCallback),t instanceof V&&this._rooms.push(t),t instanceof K&&(t.createPriorityWalls(this._priorityWallCallback),this._corridors.push(t)),!0)},i._removeSurroundingWalls=function(t,e){for(var i=O[4],n=0;n<i.length;n++){var o=i[n],r=t+o[0],s=e+o[1];delete this._walls[r+","+s],r=t+2*o[0],s=e+2*o[1],delete this._walls[r+","+s]}},i._getDiggingDirection=function(t,e){if(0>=t||0>=e||t>=this._width-1||e>=this._height-1)return null;for(var i=null,n=O[4],o=0;o<n.length;o++){var r=n[o];if(!this._map[t+r[0]][e+r[1]]){if(i)return null;i=r}}return i?[-i[0],-i[1]]:null},i._addDoors=function(){function t(t,i){return 1==e[t][i]}for(var e=this._map,i=0;i<this._rooms.length;i++){var n=this._rooms[i];n.clearDoors(),n.addDoors(t)}},e}(R),EllerMaze:function(t){function e(){return t.apply(this,arguments)||this}return _inheritsLoose(e,t),e.prototype.create=function(t){for(var e=this._fillMap(1),i=Math.ceil((this._width-2)/2),n=[],o=[],r=0;r<i;r++)n.push(r),o.push(r);for(n.push(i-1),r=1;r+3<this._height;r+=2)for(var s=0;s<i;s++){var a=2*s+1,l=r;e[a][l]=0,s!=n[s+1]&&.375<m.getUniform()&&(d(s,n,o),e[a+1][l]=0),s!=n[s]&&.375<m.getUniform()?_(s,n,o):e[a][l+1]=0}for(s=0;s<i;s++)l=r,e[a=2*s+1][l]=0,s!=n[s+1]&&(s==n[s]||.375<m.getUniform())&&(d(s,n,o),e[a+1][l]=0),_(s,n,o);for(i=0;i<this._width;i++)for(n=0;n<this._height;n++)t(i,n,e[i][n]);return this},e}(E),DividedMaze:function(t){function e(){var e=t.apply(this,arguments)||this;return e._stack=[],e._map=[],e}_inheritsLoose(e,t);var i=e.prototype;return i.create=function(t){var e=this._width,i=this._height;this._map=[];for(var n=0;n<e;n++){this._map.push([]);for(var o=0;o<i;o++)this._map[n].push(0==n||0==o||n+1==e||o+1==i?1:0)}for(this._stack=[[1,1,e-2,i-2]],this._process(),n=0;n<e;n++)for(o=0;o<i;o++)t(n,o,this._map[n][o]);return this._map=[],this},i._process=function(){for(;this._stack.length;){var t=this._stack.shift();this._partitionRoom(t)}},i._partitionRoom=function(t){for(var e=[],i=[],n=t[0]+1;n<t[2];n++){var o=this._map[n][t[3]+1];!this._map[n][t[1]-1]||!o||n%2||e.push(n)}for(n=t[1]+1;n<t[3];n++)o=this._map[t[2]+1][n],!this._map[t[0]-1][n]||!o||n%2||i.push(n);if(e.length&&i.length){e=m.getItem(e),i=m.getItem(i),this._map[e][i]=1,(n=[]).push(o=[]);for(var r=t[0];r<e;r++)this._map[r][i]=1,o.push([r,i]);for(o=[],n.push(o),r=e+1;r<=t[2];r++)this._map[r][i]=1,o.push([r,i]);for(o=[],n.push(o),r=t[1];r<i;r++)this._map[e][r]=1,o.push([e,r]);for(o=[],n.push(o),r=i+1;r<=t[3];r++)this._map[e][r]=1,o.push([e,r]);for(o=m.getItem(n),r=0;r<n.length;r++){var s=n[r];s!=o&&(s=m.getItem(s),this._map[s[0]][s[1]]=0)}this._stack.push([t[0],t[1],e-1,i-1]),this._stack.push([e+1,t[1],t[2],i-1]),this._stack.push([t[0],i+1,e-1,t[3]]),this._stack.push([e+1,i+1,t[2],t[3]])}},e}(E),IceyMaze:function(t){function e(e,i,n){return void 0===n&&(n=0),(e=t.call(this,e,i)||this)._regularity=n,e._map=[],e}_inheritsLoose(e,t);var i=e.prototype;return i.create=function(t){var e=this._width,i=this._height,n=this._fillMap(1);e-=e%2?1:2,i-=i%2?1:2;var o=0,r=[[0,0],[0,0],[0,0],[0,0]];do{var s=1+2*Math.floor(m.getUniform()*(e-1)/2),a=1+2*Math.floor(m.getUniform()*(i-1)/2);if(o||(n[s][a]=0),!n[s][a]){this._randomize(r);do{0==Math.floor(m.getUniform()*(this._regularity+1))&&this._randomize(r);for(var l=!0,h=0;4>h;h++){var c=s+2*r[h][0],u=a+2*r[h][1];if(this._isFree(n,c,u,e,i)){n[c][u]=0,n[s+r[h][0]][a+r[h][1]]=0,s=c,a=u,l=!1,o++;break}}}while(!l)}}while(o+1<e*i/4);for(e=0;e<this._width;e++)for(i=0;i<this._height;i++)t(e,i,n[e][i]);return this._map=[],this},i._randomize=function(t){for(var e=0;4>e;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(4*m.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}},i._isFree=function(t,e,i,n,o){return!(1>e||1>i||e>=n||i>=o)&&t[e][i]},e}(E),Rogue:E=function(t){function e(e,i,n){return(e=t.call(this,e,i)||this).map=[],e.rooms=[],e.connectedCells=[],(n=Object.assign({cellWidth:3,cellHeight:3},n)).hasOwnProperty("roomWidth")||(n.roomWidth=e._calculateRoomSize(e._width,n.cellWidth)),n.hasOwnProperty("roomHeight")||(n.roomHeight=e._calculateRoomSize(e._height,n.cellHeight)),e._options=n,e}_inheritsLoose(e,t);var i=e.prototype;return i.create=function(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(var e=0;e<this._width;e++)for(var i=0;i<this._height;i++)t(e,i,this.map[e][i]);return this},i._calculateRoomSize=function(t,e){var i=Math.floor(t/e*.8);return 2>(t=Math.floor(t/e*.25))&&(t=2),2>i&&(i=2),[t,i]},i._initRooms=function(){for(var t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(var e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}},i._connectRooms=function(){var t=m.getUniformInt(0,this._options.cellWidth-1),e=m.getUniformInt(0,this._options.cellHeight-1);do{var i=[0,2,4,6];i=m.shuffle(i);do{var n=!1,o=i.pop(),r=t+O[8][o][0];if(o=e+O[8][o][1],!(0>r||r>=this._options.cellWidth||0>o||o>=this._options.cellHeight)){var s=this.rooms[t][e];if(0<s.connections.length&&s.connections[0][0]==r&&s.connections[0][1]==o)break;0==(s=this.rooms[r][o]).connections.length&&(s.connections.push([t,e]),this.connectedCells.push([r,o]),t=r,e=o,n=!0)}}while(0<i.length&&0==n)}while(0<i.length)},i._connectUnconnectedRooms=function(){var t=this._options.cellWidth,e=this._options.cellHeight;this.connectedCells=m.shuffle(this.connectedCells);for(var i,n,o,r=0;r<this._options.cellWidth;r++)for(var s=0;s<this._options.cellHeight;s++)if(0==(i=this.rooms[r][s]).connections.length){var a=[0,2,4,6];a=m.shuffle(a),o=!1;do{var l=a.pop(),h=r+O[8][l][0];if(l=s+O[8][l][1],!(0>h||h>=t||0>l||l>=e)){if(o=!0,0==(n=this.rooms[h][l]).connections.length)break;for(h=0;h<n.connections.length;h++)if(n.connections[h][0]==r&&n.connections[h][1]==s){o=!1;break}if(o)break}}while(a.length);o?i.connections.push([n.cellx,n.celly]):console.log("-- Unable to connect room.")}},i._createRandomRoomConnections=function(){},i._createRooms=function(){for(var t,e,i,n,o,r=this._width,s=this._height,a=this._options.cellWidth,l=this._options.cellHeight,h=Math.floor(this._width/a),c=Math.floor(this._height/l),u=this._options.roomWidth,p=this._options.roomHeight,g=0;g<a;g++)for(var f=0;f<l;f++){if(0==(i=h*g)&&(i=1),0==(n=c*f)&&(n=1),t=m.getUniformInt(u[0],u[1]),e=m.getUniformInt(p[0],p[1]),0<f)for(o=this.rooms[g][f-1];3>n-(o.y+o.height);)n++;if(0<g)for(o=this.rooms[g-1][f];3>i-(o.x+o.width);)i++;o=Math.round(m.getUniformInt(0,h-t)/2);for(var d=Math.round(m.getUniformInt(0,c-e)/2);i+o+t>=r;)o?o--:t--;for(;n+d+e>=s;)d?d--:e--;for(i+=o,n+=d,this.rooms[g][f].x=i,this.rooms[g][f].y=n,this.rooms[g][f].width=t,this.rooms[g][f].height=e,o=i;o<i+t;o++)for(d=n;d<n+e;d++)this.map[o][d]=0}},i._getWallPosition=function(t,e){if(1==e||3==e){var i=m.getUniformInt(t.x+1,t.x+t.width-2);if(1==e){var n=t.y-2;t=n+1}else t=(n=t.y+t.height+1)-1;this.map[i][t]=0}else n=m.getUniformInt(t.y+1,t.y+t.height-2),2==e?t=(i=t.x+t.width+1)-1:t=(i=t.x-2)+1,this.map[t][n]=0;return[i,n]},i._drawCorridor=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];e=t[0],t=t[1];var o=[],r=Math.abs(i),s=Math.abs(n),a=m.getUniform(),l=1-a;for(i=0<i?2:6,n=0<n?4:0,r<s?(a=Math.ceil(s*a),o.push([n,a]),o.push([i,r]),a=Math.floor(s*l),o.push([n,a])):(a=Math.ceil(r*a),o.push([i,a]),o.push([n,s]),a=Math.floor(r*l),o.push([i,a])),this.map[e][t]=0;0<o.length;)for(r=o.pop();0<r[1];)e+=O[8][r[0]][0],t+=O[8][r[0]][1],this.map[e][t]=0,--r[1]},i._createCorridors=function(){for(var t,e,i,n,o=this._options.cellWidth,r=this._options.cellHeight,s=0;s<o;s++)for(var a=0;a<r;a++){t=this.rooms[s][a];for(var l=0;l<t.connections.length;l++)e=t.connections[l],(e=this.rooms[e[0]][e[1]]).cellx>t.cellx?(i=2,n=4):e.cellx<t.cellx?(i=4,n=2):e.celly>t.celly?(i=3,n=1):(i=1,n=3),this._drawCorridor(this._getWallPosition(t,i),this._getWallPosition(e,n))}},e}(E)};var j=.5*(Math.sqrt(3)-1),P=(3-Math.sqrt(3))/6;E={Simplex:function(t){function i(e){void 0===e&&(e=256);var i=t.call(this)||this;i._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];for(var n=[],o=0;o<e;o++)n.push(o);for(n=m.shuffle(n),i._perms=[],i._indexes=[],o=0;o<2*e;o++)i._perms.push(n[o%e]),i._indexes.push(i._perms[o]%i._gradients.length);return i}return _inheritsLoose(i,t),i.prototype.get=function(t,i){var n=this._perms,o=this._indexes,r=n.length/2,s=0,a=0,l=0,h=(t+i)*j,c=Math.floor(t+h),u=Math.floor(i+h),p=(c+u)*P,g=i-(u-p);if((h=t-(c-p))>g)var f=1,d=0;else f=0,d=1;p=h-f+P;var _=g-d+P;i=h-1+2*P,t=g-1+2*P,c=e(c,r),r=e(u,r);var m=.5-h*h-g*g;return 0<=m&&(m*=m,u=o[c+n[r]],s=m*m*((s=this._gradients[u])[0]*h+s[1]*g)),0<=(h=.5-p*p-_*_)&&(h*=h,u=o[c+f+n[r+d]],a=h*h*((a=this._gradients[u])[0]*p+a[1]*_)),0<=(h=.5-i*i-t*t)&&(h*=h,u=o[c+1+n[r+1]],l=h*h*((n=this._gradients[u])[0]*i+n[1]*t)),70*(s+a+l)},i}(function(){})},G={Dijkstra:G=function(t){function e(e,i,n,o){return(n=t.call(this,e,i,n,o)||this)._computed={},n._todo=[],n._add(e,i,null),n}_inheritsLoose(e,t);var i=e.prototype;return i.compute=function(t,e,i){var n=t+","+e;if(n in this._computed||this._compute(t,e),n in this._computed)for(t=this._computed[n];t;)i(t.x,t.y),t=t.prev},i._compute=function(t,e){for(;this._todo.length;){var i=this._todo.shift();if(i.x==t&&i.y==e)break;for(var n=this._getNeighbors(i.x,i.y),o=0;o<n.length;o++){var r=n[o],s=r[0];s+","+(r=r[1])in this._computed||this._add(s,r,i)}}},i._add=function(t,e,i){i={x:t,y:e,prev:i},this._computed[t+","+e]=i,this._todo.push(i)},e}(H=function(){function t(t,e,i,n){void 0===n&&(n={}),this._toX=t,this._toY=e,this._passableCallback=i,this._options=Object.assign({topology:8},n),this._dirs=O[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}return t.prototype._getNeighbors=function(t,e){for(var i=[],n=0;n<this._dirs.length;n++){var o=this._dirs[n],r=t+o[0];o=e+o[1],this._passableCallback(r,o)&&i.push([r,o])}return i},t}()),AStar:H=function(t){function e(e,i,n,o){return void 0===o&&(o={}),(e=t.call(this,e,i,n,o)||this)._todo=[],e._done={},e}_inheritsLoose(e,t);var i=e.prototype;return i.compute=function(t,e,i){for(this._todo=[],this._done={},this._fromX=t,this._fromY=e,this._add(this._toX,this._toY,null);this._todo.length;){var n=this._todo.shift(),o=n.x+","+n.y;if(!(o in this._done)){if(this._done[o]=n,n.x==t&&n.y==e)break;o=this._getNeighbors(n.x,n.y);for(var r=0;r<o.length;r++){var s=o[r],a=s[0];a+","+(s=s[1])in this._done||this._add(a,s,n)}}}if(t=this._done[t+","+e])for(;t;)i(t.x,t.y),t=t.prev},i._add=function(t,e,i){var n=this._distance(t,e);for(e=(t={x:t,y:e,prev:i,g:i?i.g+1:0,h:n}).g+t.h,i=0;i<this._todo.length;i++){var o=this._todo[i],r=o.g+o.h;if(e<r||e==r&&n<o.h)return void this._todo.splice(i,0,t)}this._todo.push(t)},i._distance=function(t,e){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(e-this._fromY);case 6:return(e=Math.abs(e-this._fromY))+Math.max(0,(Math.abs(t-this._fromX)-e)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(e-this._fromY))}},e}(H)},H=function(){function t(t){this._scheduler=t,this._lock=1}var e=t.prototype;return e.start=function(){return this.unlock()},e.lock=function(){return this._lock++,this},e.unlock=function(){if(!this._lock)throw Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){var t=this._scheduler.next();if(!t)return this.lock();(t=t.act())&&t.then&&(this.lock(),t.then(this.unlock.bind(this)))}return this},t}(),R=function(){function t(t,e){void 0===e&&(e={}),this._reflectivityCallback=t,this._options={},e=Object.assign({passes:1,emissionThreshold:100,range:10},e),this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(e)}var e=t.prototype;return e.setOptions=function(t){return Object.assign(this._options,t),t&&t.range&&this.reset(),this},e.setFOV=function(t){return this._fov=t,this._fovCache={},this},e.setLight=function(t,e,i){return t=t+","+e,i?this._lights[t]="string"==typeof i?r(i):i:delete this._lights[t],this},e.clearLights=function(){this._lights={}},e.reset=function(){return this._reflectivityCache={},this._fovCache={},this},e.compute=function(t){var e,i={},n={},o={};for(e in this._lights){var r=this._lights[e];n[e]=[0,0,0],s(n[e],r)}for(e=0;e<this._options.passes;e++)this._emitLight(n,o,i),e+1!=this._options.passes&&(n=this._computeEmitters(o,i));for(var a in o)n=a.split(","),t(i=parseInt(n[0]),n=parseInt(n[1]),o[a]);return this},e._emitLight=function(t,e,i){for(var n in t){var o=n.split(","),r=parseInt(o[0]);o=parseInt(o[1]),this._emitLightFromCell(r,o,t[n],e),i[n]=1}return this},e._computeEmitters=function(t,e){var i,n={};for(i in t)if(!(i in e)){var o=t[i];if(i in this._reflectivityCache)var r=this._reflectivityCache[i];else{var s=i.split(",");r=parseInt(s[0]),s=parseInt(s[1]),r=this._reflectivityCallback(r,s),this._reflectivityCache[i]=r}if(0!=r){s=[0,0,0];for(var a=0,l=0;3>l;l++){var h=Math.round(o[l]*r);s[l]=h,a+=h}a>this._options.emissionThreshold&&(n[i]=s)}}return n},e._emitLightFromCell=function(t,e,i,n){var o=t+","+e;for(var r in t=o in this._fovCache?this._fovCache[o]:this._updateFOV(t,e)){e=t[r],r in n?o=n[r]:(o=[0,0,0],n[r]=o);for(var s=0;3>s;s++)o[s]+=Math.round(i[s]*e)}return this},e._updateFOV=function(t,e){var i={};this._fovCache[t+","+e]=i;var n=this._options.range;return this._fov.compute(t,e,n,function(t,e,o,r){0!=(o=r*(1-o/n))&&(i[t+","+e]=o)}.bind(this)),i},t}(),t.Util=b,t.Color=v,t.Text=y,t.RNG=m,t.Display=M,t.StringGenerator=w,t.EventQueue=D,t.Scheduler=C,t.FOV=k,t.Map=x,t.Noise=E,t.Path=G,t.Engine=H,t.Lighting=R,t.DEFAULT_WIDTH=80,t.DEFAULT_HEIGHT=25,t.DIRS=O,t.KEYS={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95},Object.defineProperty(t,"__esModule",{value:!0})});class GameObject{constructor(t,e,i,n,o=!1,r=!1){this.type=t,this.x=e,this.y=i,this.name=n,this.blocks=o,this.blocksSight=r,this.graphics=null,this.lighting=null,this.fighter=null,this.ai=null,this.inventoryComponent=null,this.interactable=null}setGraphics(t){t.setOwner(this),this.graphics=t}setLighting(t){t.setOwner(this),this.lighting=t}setFighter(t){t.setOwner(this),this.fighter=t}setAI(t){t.setOwner(this),this.ai=t}setInventory(t){t.setOwner(this),this.inventoryComponent=t}setInteractable(t){t.setOwner(this),this.interactable=t}act(){this.ai&&"function"==typeof this.ai.act&&this.ai.act(),this.fighter&&"function"==typeof this.fighter.act&&this.fighter.act()}}const createObject=function(t,e=0,i=0){if(!(t in objectData))throw new Error(`${t} is not valid object id`);const n=objectData[t];let o=new GameObject(t,e,i,n.name,n.blocks,n.blocksSight);if(n.ai)switch(n.ai){case"player_control_ai":o.setAI(new PlayerControlAI);break;case"basic_monster_ai":o.setAI(new BasicMonsterAI(n.sightRange));break;case"patrolling_monster_ai":o.setAI(new PatrollingMonsterAI(n.sightRange));break;case"chest_ai":o.setAI(new ChestAI(n.bgColor,n.emptyColor));break;case"dropped_item_ai":o.setAI(new DroppedItemAI);break;default:console.error(`Unhandled AI type ${n.ai}`)}if(n.graphics)switch(n.graphics){case"basic_graphics":o.setGraphics(new BasicGraphics(n.char,n.fgColor,n.bgColor));break;case"draw_after_seen":o.setGraphics(new DrawAfterSeen(n.char,n.fgColor,n.bgColor));break;default:console.error(`Unhandled Graphics type ${n.graphics}`)}if(n.lighting)switch(n.lighting){case"reflectivity":o.setLighting(new ReflectivityLighting(n.lightingColor,n.lightingRange));break;case"player_lighting":o.setLighting(new PlayerLighting(n.lightingColor,n.lightingRange));break;default:console.error(`Unhandled Lighting type ${n.lighting}`)}if(n.fighter){let t;switch(n.onDeath){case"default":t=enemyDeathCallback;break;case"removeFromWorld":t=removeDeathCallback;break;default:console.error(`Unhandled onDeath type ${n.onDeath}`)}switch(n.fighter){case"basic_fighter":o.setFighter(new BasicFighter(n,t));break;default:console.error(`Unhandled Fighter type ${n.fighter}`)}}if(n.inventory){switch(n.inventory){case"basic_inventory":o.setInventory(new BasicInventory);break;default:console.error(`Unhandled Inventory type ${n.inventory}`)}if(n.inventoryPool)for(var r=0;r<n.inventoryPool.length;r++)ROT.RNG.getUniform()<=n.inventoryPool[r][1]&&o.inventoryComponent.addItem(n.inventoryPool[r][0])}if(n.interactable)switch(n.interactable){case"give_items_interactable":o.setInteractable(new GiveItemsInteractable);break;case"give_spell_interactable":o.setInteractable(new GiveSpellInteractable);break;case"load_level_interactable":o.setInteractable(new LoadLevelInteractable);break;case"door_interactable":o.setInteractable(new DoorInteractable);break;default:console.error(`Unhandled Interactable type ${n.interactable}`)}return o},enemyDeathCallback=function(t){if(Game.displayMessage(t.name+" has been killed"),t.graphics.char="%",t.graphics.fgColor="green",t.graphics.bgColor="darkred",t.blocks=!1,t.fighter=null,t.ai=null,t.interactable=null,t.name="Remains of a "+t.name,t.inventoryComponent.getIDsAndCounts().length>0){let e=createObject("dropped_item",t.x,t.y);e.inventoryComponent=t.inventoryComponent,Game.addObject(e)}t.inventoryComponent=null},removeDeathCallback=function(t){if(t.inventoryComponent.getIDsAndCounts().length>0){let e=createObject("dropped_item",t.x,t.y);e.inventoryComponent=t.inventoryComponent,Game.addObject(e)}Game.removeObject(t)};class BasicGraphics{constructor(t,e,i){this.char=t,this.fgColor=e,this.bgColor=i,this.owner=null}setOwner(t){this.owner=t}draw(t,e){this.owner&&e[this.owner.y][this.owner.x].isVisibleAndLit()&&t.draw(this.owner.x,this.owner.y,this.char,this.fgColor,this.bgColor)}}class DrawAfterSeen{constructor(t,e,i){this.char=t,this.fgColor=e,this.bgColor=i,this.owner=null}setOwner(t){this.owner=t}draw(t,e){this.owner&&e[this.owner.y][this.owner.x].explored&&t.draw(this.owner.x,this.owner.y,this.char,this.fgColor,this.bgColor)}}function createReflectivityCallback(t){return function(e,i){return e<0||i<0||e>=WORLD_WIDTH||i>=WORLD_HEIGHT?0:t[i][e].blocksSight?0:t[i][e].reflectivity}}class ReflectivityLighting{constructor(t,e){this.color=t,this.range=e}setOwner(t){this.owner=t}compute(t){const e=new ROT.FOV.PreciseShadowcasting(createPassableSightCallback(this.owner)),i=new ROT.Lighting(createReflectivityCallback(t),{range:this.range,passes:2});i.setFOV(e),i.setLight(this.owner.x,this.owner.y,this.color),i.compute(function(e,i,n){e<0||i<0||e>=WORLD_WIDTH||i>=WORLD_HEIGHT||(t[i][e].lightingColor=ROT.Color.toRGB(ROT.Color.add(ROT.Color.fromString(t[i][e].lightingColor),n)))}),t[this.owner.y][this.owner.x].lightingColor=this.color}}class PlayerLighting{constructor(t,e){this.color=t,this.range=e}setOwner(t){this.owner=t}compute(t){new ROT.FOV.PreciseShadowcasting(createPassableSightCallback(this.owner)).compute(this.owner.x,this.owner.y,100,function(e,i,n,o){e<0||i<0||e>=WORLD_WIDTH||i>=WORLD_HEIGHT||(t[i][e].visible=!0)});const e=new ROT.FOV.PreciseShadowcasting(createPassableSightCallback(this.owner)),i=new ROT.Lighting(createReflectivityCallback(t),{range:this.range,passes:2});i.setFOV(e),i.setLight(this.owner.x,this.owner.y,this.color),i.compute(function(e,i,n){e<0||i<0||e>=WORLD_WIDTH||i>=WORLD_HEIGHT||(t[i][e].lightingColor=ROT.Color.toRGB(ROT.Color.add(ROT.Color.fromString(t[i][e].lightingColor),n)),t[i][e].explored=!0)})}}class Tile{constructor(t,e,i,n,o,r,s,a,l=!1,h=!1){this.name=t,this.char=e,this.fgColor=i,this.bgColor=n,this.fgColorExplored=o,this.bgColorExplored=r,this.blocks=s,this.blocksSight=a,this.visible=l,this.explored=h,this.reflectivity=.18,this.lightingColor=n}isVisibleAndLit(){return this.visible&&this.lightingColor!==COLOR_AMBIENT_LIGHT}}const loadTiledMap=function(t){const e=TileMaps[t],i=e.tileheight;let n=[],o=[],r=null;if(e.width!==WORLD_WIDTH&&e.height!==WORLD_HEIGHT)throw new Error(`Loaded map ${name} doesn't match world width/height`);if(2!==e.layers.length)throw new Error(`Loaded map ${name} should only have two layers`);const s=e.layers[0].data.map(t=>{if(!(t in tileData))throw new Error(`${t} is not valid tile`);const e=tileData[t];return new Tile(e.name,e.char,e.fgColor,e.bgColor,e.fgColorExplored,e.bgColorExplored,e.blocks,e.blocksSight)});for(let t=0;t<s.length;t+=WORLD_WIDTH)n.push(s.slice(t,t+WORLD_WIDTH));return e.layers[1].objects.forEach(t=>{const e=function(e){if(!t.properties||!t.properties.length)return null;let i=t.properties.filter(t=>t.name===e);return 0===i.length?null:i[0].value};let n,s=e("id"),a=e("inventory"),l=e("levelName"),h=e("spellId");if(s){if(t.point)"player"===s?r=[Math.floor(t.x/i),Math.floor(t.y/i)]:(n=createObject(s,Math.floor(t.x/i),Math.floor(t.y/i)),a&&n.inventoryComponent&&a.split(",").forEach(t=>n.inventoryComponent.addItem(t)),l&&n.interactable&&n.interactable.setLevel&&n.interactable.setLevel(l),h&&n.interactable&&n.interactable.setSpell&&n.interactable.setSpell(h),o.push(n));else if("Rectangle"===t.type){let e=Math.floor(t.x/i),n=Math.floor(t.y/i);const r=Math.floor(t.width/i)+e,a=Math.floor(t.height/i)+n;for(let t=n;t<a;t++)for(let i=e;i<r;i++)o.push(createObject(s,t,i))}}else console.error(`No id for ${t.name}`)}),{map:n,playerLocation:r,objects:o}},addStairs=function(t,e){const{x:i,y:n}=findEmptySpace(t,e);e.push(createObject("stairs",i,n))},addDungeonStairs=function(t,e,i){const{x:n,y:o}=findEmptySpaceInRoom(t,e,i);i.push(createObject("stairs",n,o))},findEmptySpace=function(t,e){let i=0,n=0;for(;isBlocked(t,e,i,n);)i=Math.floor(ROT.RNG.getUniform()*WORLD_WIDTH),n=Math.floor(ROT.RNG.getUniform()*WORLD_HEIGHT);return{x:i,y:n}},findEmptySpaceInRoom=function(t,e,i){let n=0,o=0;for(;isBlocked(t,i,n,o);){const t=e[Math.floor(ROT.RNG.getUniform()*e.length)];n=randomIntFromInterval(t.getLeft()+1,t.getRight()-1),o=randomIntFromInterval(t.getBottom()-1,t.getTop()+1)}return{x:n,y:o}},getObjectsAtLocation=function(t,e,i){return t.filter(t=>t.x==e&&t.y==i)},isBlocked=function(t,e,i,n){if(i<0||n<0||i>=WORLD_WIDTH||n>=WORLD_HEIGHT||t[n][i].blocks)return!0;const o=e.filter(t=>t.x==i&&t.y==n&&!0===t.blocks)[0];return o||null},isSightBlocked=function(t,e,i,n){if(i<0||n<0||i>=WORLD_WIDTH||n>=WORLD_HEIGHT||t[n][i].blocksSight)return!0;const o=getObjectsAtLocation(e,i,n);for(var r=0;r<o.length;r++)if(o[r].blocksSight)return!0;return!1},drawTile=function(t,e,i,n){let o,r;e.blocks?e.explored?e.explored&&e.visible?(o=e.fgColor,r=e.bgColor):e.explored&&!e.visible&&(o=COLOR_DARK_WALL,r=COLOR_DARK_WALL):(o=COLOR_INVISIBLE_WALL,r=COLOR_INVISIBLE_WALL):e.isVisibleAndLit()?(o=e.fgColor,r=e.lightingColor):e.explored?(o=COLOR_DARK_GROUND,r=COLOR_DARK_GROUND):(o=COLOR_INVISIBLE_GROUND,r=COLOR_INVISIBLE_GROUND),t.draw(i,n,e.char,o,r)},distanceBetweenObjects=function(t,e){const i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i**2+n**2)},getClosestVisibleFighter=function(t,e,i,n){let o=null,r=n+1;for(let n=0;n<e.length;n++){const s=e[n];if(void 0!==s.fighter&&null!==s.fighter&&s!==i&&t[s.y][s.x].visible){const t=distanceBetweenObjects(i,s);t<r&&(o=s,r=t)}}return o},resetVisibility=function(t){for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)t[e][i].visible=!1,t[e][i].lightingColor=COLOR_AMBIENT_LIGHT},setAllToExplored=function(t){for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)t[e][i].explored=!0},drawMap=function(t,e){for(let i=0;i<e.length;i++)for(let n=0;n<e[i].length;n++)drawTile(t,e[i][n],n,i)},mouseTarget=function(t){Game.unhookMouseLook(),Game.drawAll(),Game.canvas.addEventListener("mousedown",function e(i){if(0===i.button){const o=Game.display.eventToPosition(i);let r;Game.canvas.removeEventListener("mousedown",e),Game.hookMouseLook();let s=getObjectsAtLocation(Game.gameObjects,o[0],o[1]);for(var n=0;n<s.length;n++)if(s[n].fighter){r=s[n];break}return r&&r.fighter?t(r):t(null)}})},castHeal=function(t,e,i){return e.fighter.hp>=e.fighter.maxHp?(e===Game.player?Game.displayMessage("You are already at full health."):Game.displayMessage(e.name+" tries and fails to take a health potion"),i(!1)):(e.fighter.heal(t.value),i(!0))},castDamageSpell=function(t,e,i){Game.displayMessage("Left click on an enemy to target it, click elsewhere to cancel"),mouseTarget(function(n){if(null===n)return Game.displayMessage("Canceled casting"),i(!1);if(Game.displayMessage(`Spell hits ${n.name} for ${t.value} damage`),n.fighter.takeDamage(e,t.value,t.damageType),n.fighter&&t.statusEffectFunc&&ROT.RNG.getUniform()<=n.fighter.ailmentSusceptibility){const e=Math.round(.0625*n.fighter.maxHp),i=randomIntFromInterval(3,6);n.fighter.addStatusEffect(t.statusEffectFunc(n,e,i))}return i(!0)})},castWildDamageSpell=function(t,e,i){const n=getClosestVisibleFighter(Game.map,Game.gameObjects,e,8);if(null===n)return e===Game.player&&Game.displayMessage("No target is close enough to use the scroll"),i(!1);if(Game.displayMessage(`Spell hits ${n.name} for ${t.value} damage`),n.fighter.takeDamage(e,t.value,t.damageType),n.fighter&&t.statusEffectFunc&&ROT.RNG.getUniform()<=n.fighter.ailmentSusceptibility){const e=Math.round(.0625*n.fighter.maxHp),i=randomIntFromInterval(3,6);n.fighter.addStatusEffect(t.statusEffectFunc(n,e,i))}return i(!0)},castConfuse=function(t,e,i){Game.displayMessage("Left click on an enemy to target it, click elsewhere to cancel"),mouseTarget(function(e){if(null===e)return i(!1);Game.displayMessage(e.name+" is now confused");const n=e.ai;return e.ai=new ConfusedAI(n,t.value),e.ai.owner=e,i(!0)})},castClairvoyance=function(t,e,i){return Game.displayMessage("You have been granted Clairvoyance"),setAllToExplored(Game.map),i(!0)};class BasicFighter{constructor(t,e=null){this.hp=t.maxHp,this.maxHp=t.maxHp,this.mana=t.maxMana,this.maxMana=t.maxMana,this.strength=t.strength,this.defense=t.defense,this.deathCallback=e,this.owner=null,this.experience=t.experience,this.experienceGiven=t.experienceGiven,this.level=t.level,this.criticalChance=.05,this.criticalDamageMultipler=1.5,this.statusEffects=[],this.ailmentSusceptibility=t.ailmentSusceptibility,this.knownSpells=new Set}setOwner(t){this.owner=t}act(){const t=LEVEL_UP_BASE+this.level*LEVEL_UP_FACTOR;if(this.experience>=t&&(this.level+=1,this.experience=0,this.hp=this.maxHp,this.strength++,this.owner===Game.player&&Game.displayMessage("You reached level "+this.level+"!")),this.statusEffects.length>0)for(let t=0;t<this.statusEffects.length;t++){const e=this.statusEffects[t];e.act(),0===e.turns&&(Game.displayMessage(`${this.owner.name} recovered from its ${e.name}`),this.statusEffects.splice(t,1))}}takeDamage(t,e,i){e>0&&(this.hp-=e),this.hp<=0&&(t.fighter.experience+=this.experienceGiven,null!==this.deathCallback&&this.deathCallback(this.owner))}attack(t){if(!t.fighter)return;let e=Math.round(Math.max(1,this.strength-t.fighter.defense)),i=!1;ROT.RNG.getUniform()<=this.criticalChance&&(e=Math.ceil(e*this.criticalDamageMultipler),i=!0),e>0?(i?Game.displayMessage("CRITICAL! "+this.owner.name+" attacks "+t.name+" for "+e+" damage."):Game.displayMessage(this.owner.name+" attacks "+t.name+" for "+e+" damage."),t.fighter.takeDamage(this.owner,e)):Game.displayMessage(this.owner.name+" attacks "+t.name+", but it's too weak!")}heal(t){this.hp+=t,this.hp>this.maxHp&&(this.hp=this.maxHp)}useMana(t){this.mana=Math.max(this.mana-t,0)}addStatusEffect(t){this.statusEffects.push(t)}addSpellById(t){return!this.knownSpells.has(t)&&(this.knownSpells.add(t),!0)}getKnownSpells(){return[...this.knownSpells]}}const clone=t=>JSON.parse(JSON.stringify(t));class BasicInventory{constructor(){this.owner=null,this._inventory={}}setOwner(t){this.owner=t}getIDsAndCounts(){return Reflect.ownKeys(this._inventory).map(t=>({id:t,count:this._inventory[t]}))}getNamesAndCounts(){return Reflect.ownKeys(this._inventory).map(t=>({name:itemData[t].displayName,count:this._inventory[t]}))}hasItem(t){return t in this._inventory}addItem(t,e=1){if(t in this._inventory){const i=this._inventory[t]+e;if(100===i)return!1;this._inventory[t]=i}else this._inventory[t]=e;return!0}useItem(t){if(!(t in this._inventory))throw new Error(`Item ${t} not in inventory`);this._inventory[t]--,0===this._inventory[t]&&delete this._inventory[t]}}class GiveItemsInteractable{constructor(){this.owner=null}setOwner(t){this.owner=t}interact(t){if(this.owner.inventoryComponent){const e=this.owner.inventoryComponent.getIDsAndCounts();if(e.length>0)for(let i=0;i<e.length;i++){const n=e[i];Game.displayMessage("Found a "+itemData[n.id].displayName),t.inventoryComponent.addItem(n.id,n.count),this.owner.inventoryComponent.useItem(n.id)}else Game.displayMessage("Empty")}else console.error("Missing inventoryComponent on ",this.owner)}}class GiveSpellInteractable{constructor(){this.owner=null,this.spellId=null}setOwner(t){this.owner=t}setSpell(t){this.spellId=t}interact(t){if(!this.spellId)throw new Error("No spell id given");if(!(this.spellId in spellData))throw new Error(`${this.spellId} is not a valid spell`);const e=t.fighter.addSpellById(this.spellId),i=spellData[this.spellId];e?Game.displayMessage(`You learned a new spell: ${i.name}`):Game.displayMessage(`You already know ${i.name}`)}}class DoorInteractable{constructor(){this.owner=null,this.levelName=null}setLevel(t){this.levelName=t}setOwner(t){this.owner=t}interact(t){Game.removeObject(this.owner)}}class LoadLevelInteractable{constructor(){this.owner=null,this.levelName=null}setLevel(t){this.levelName=t}setOwner(t){this.owner=t}interact(t){if(!this.levelName)throw new Error("No level name has been set for load");Game.loadLevel(this.levelName)}}class Effect{constructor(t,e,i,n){this.owner=t,this.name=e,this.turns=i,this.actCallback=n}act(){this.actCallback(this.owner,this.name),this.turns--}}const createBurnEffect=function(t,e,i){return new Effect(t,"Burn",i,function(t,i){t.fighter&&t.fighter.takeDamage(null,e),t===Game.player?Game.displayMessage("You were hurt by the burn for "+e+" damage"):Game.displayMessage(t.name+" was hurt by the burn for "+e+" damage")})},createPassableCallback=function(t){return function(e,i){return t.x===e&&t.y===i||null===isBlocked(Game.map,Game.gameObjects,e,i)}},createPassableSightCallback=function(t){return function(e,i){return t.x===e&&t.y===i||!1===isSightBlocked(Game.map,Game.gameObjects,e,i)}},createVisibilityCallback=function(t){return function(e,i,n,o){e===Game.player.x&&i===Game.player.y&&o>0&&(Game.displayMessage(t.owner.name+" saw you"),t.state="chase")}};class BasicMonsterAI{constructor(t){this.owner=null,this.state="wander",this.sightRange=t}setOwner(t){this.owner=t}act(){if("wander"===this.state){new ROT.FOV.PreciseShadowcasting(createPassableSightCallback(this.owner)).compute(this.owner.x,this.owner.y,this.sightRange,createVisibilityCallback(this));const t=ROT.DIRS[8][ROT.RNG.getItem([0,1,2,3,4,5,6,7])],e=this.owner.x+t[0],i=this.owner.y+t[1];if(null!==isBlocked(Game.map,Game.gameObjects,e,i))return;this.owner.x=e,this.owner.y=i}else if("chase"===this.state){let t=Game.player.x,e=Game.player.y,i=new ROT.Path.AStar(t,e,createPassableCallback(this.owner),{topology:8}),n=[],o=function(t,e){n.push([t,e])};if(i.compute(this.owner.x,this.owner.y,o),n.shift(),1==n.length)this.owner.fighter.attack(Game.player);else{if(0===n.length)return;t=n[0][0],e=n[0][1],this.owner.x=t,this.owner.y=e}}}}class PatrollingMonsterAI{constructor(t){this.owner=null,this.state="patrol",this.sightRange=t,this.patrolTarget=null}setOwner(t){this.owner=t}act(){if("patrol"===this.state){new ROT.FOV.PreciseShadowcasting(createPassableSightCallback(this.owner)).compute(this.owner.x,this.owner.y,this.sightRange,createVisibilityCallback(this)),null===this.patrolTarget&&(this.patrolTarget=findEmptySpace(Game.map,Game.gameObjects));const t=new ROT.Path.AStar(this.patrolTarget.x,this.patrolTarget.y,createPassableCallback(this.owner),{topology:8});let e=[];const i=function(t,i){e.push([t,i])};if(t.compute(this.owner.x,this.owner.y,i),e.shift(),0===e.length)return void(this.patrolTarget=null);this.owner.x=e[0][0],this.owner.y=e[0][1]}else if("chase"===this.state){const t=new ROT.Path.AStar(Game.player.x,Game.player.y,createPassableSightCallback(this.owner),{topology:8});let e=[],i=function(t,i){e.push([t,i])};if(t.compute(this.owner.x,this.owner.y,i),e.shift(),1==e.length)this.owner.fighter.attack(Game.player);else{if(0===e.length)return;this.owner.x=e[0][0],this.owner.y=e[0][1]}}}}class ConfusedAI{constructor(t,e){this.owner=null,this.oldAI=t,this.turns=e}act(){if(this.turns>0){const t=ROT.DIRS[4][ROT.RNG.getItem([0,1,2,3])],e=this.owner.x+t[0],i=this.owner.y+t[1];if(null!==isBlocked(Game.map,Game.gameObjects,e,i))return;this.owner.x=e,this.owner.y=i}else this.owner===Game.player?Game.displayMessage("You are no longer confused"):Game.displayMessage(this.owner.name+" is no longer confused"),this.owner.ai=this.oldAI;this.turns--}}class ChestAI{constructor(t,e){this.owner=null,this.bgColor=t,this.emptyColor=e}setOwner(t){this.owner=t}act(){this.owner&&this.owner.inventoryComponent?0===this.owner.inventoryComponent.getIDsAndCounts().length?this.owner.graphics.bgColor=this.emptyColor:this.owner.graphics.bgColor=this.bgColor:console.error("Missing inventoryComponent for ChestAI")}}class DroppedItemAI{constructor(t,e){this.owner=null,this.bgColor=t,this.emptyColor=e}setOwner(t){this.owner=t}act(){this.owner&&this.owner.inventoryComponent?0===this.owner.inventoryComponent.getIDsAndCounts().length&&Game.removeObject(this.owner):console.error("Missing inventoryComponent for DroppedItemAI")}}const moveCommand=function(t,e,i){return function(){const n=ROT.DIRS[i][e],o=t.x+n[0],r=t.y+n[1],s=isBlocked(Game.map,Game.gameObjects,o,r);if(!0===s)return!1;if(s){if(s.interactable)return s.interactable.interact(t),!0;if(s.fighter)return t.fighter.attack(s),!0}return t.x=o,t.y=r,!0}},getItemCommand=function(t){return function(){const e=Game.gameObjects.filter(e=>"dropped_item"===e.type&&e.x===t.x&&e.y===t.y);return e.length>0?(e[0].interactable.interact(t),!0):(Game.displayMessage("There's no item to pick up"),!1)}},openInventoryCommand=function(t){return function(){return showSelectionMenu("Player Inventory",t.inventoryComponent.getNamesAndCounts(),"inventory",WIDTH),t.ai.state="inventory",!1}},openSpellsCommand=function(t){return function(){return showSelectionMenu("Spells",t.fighter.getKnownSpells().map(t=>spellData[t]),"spells",WIDTH),t.ai.state="spell_selection",!1}},openKeyBindingCommand=function(t){return function(){return showKeyBindingMenu(),t.ai.state="keybinding",!1}},killPlayer=function(t){t.fighter=null,t.ai=null,t.inventoryComponent=null};class PlayerControlAI{constructor(){this.owner=null,this.keyCommandMap={},this.state="normal"}setOwner(t){this.owner=t,this.keyCommandMap={w:["Move Up",moveCommand(this.owner,0,8)],e:["Move Up Right",moveCommand(this.owner,1,8)],d:["Move Right",moveCommand(this.owner,2,8)],c:["Move Down Right",moveCommand(this.owner,3,8)],s:["Move Down",moveCommand(this.owner,4,8)],z:["Move Down Left",moveCommand(this.owner,5,8)],a:["Move Left",moveCommand(this.owner,6,8)],q:["Move Up Left",moveCommand(this.owner,7,8)],i:["Inventory",openInventoryCommand(this.owner)],g:["Get Item",getItemCommand(this.owner)],m:["Spells",openSpellsCommand(this.owner)],Escape:["Key Bindings",openKeyBindingCommand(this.owner)]}}act(){Game.engine.lock(),window.addEventListener("keydown",this)}handleEvent(t){if(t.preventDefault(),null===this.owner.fighter||this.owner.fighter.hp<=0)return;const e=t.key;if("normal"===this.state){if(!(e in this.keyCommandMap))return;if(!this.keyCommandMap[e][1]())return}else{if("inventory"===this.state){const t="a".charCodeAt(0),i="z".charCodeAt(0),n=e.charCodeAt(0);if(n<t&&n>i)return;if("Escape"===e)return this.state="normal",void Game.manager.act();const o={},r=this.owner.inventoryComponent.getIDsAndCounts();for(let e=0;e<r.length;e++)o[t+e]=r[e].id;if(!(n in o))return;const s=itemData[o[n]],a=t=>{this.owner.ai.state="normal",t&&(this.owner.inventoryComponent.useItem(o[n]),Game.displayMessage("Used "+s.displayName),Game.engine.unlock())};return void s.useFunc(s,this.owner,a.bind(this))}if("spell_selection"===this.state){const t="a".charCodeAt(0),i="z".charCodeAt(0),n=e.charCodeAt(0);if(n<t&&n>i)return;if("Escape"===e)return this.state="normal",void Game.manager.act();const o={},r=this.owner.fighter.getKnownSpells();for(let e=0;e<r.length;e++)o[t+e]=r[e];if(!(n in o))return;const s=spellData[o[n]];if(s.manaCost>this.owner.fighter.mana)return void Game.displayMessage(`Not enough mana to cast ${s.name}`);const a=t=>{this.owner.ai.state="normal",t&&(this.owner.fighter.useMana(s.manaCost),Game.engine.unlock())};s.useFunc(s,this.owner,a.bind(this))}else"keybinding"===this.state&&console.log("fix me")}window.removeEventListener("keydown",this),Game.engine.unlock()}}const drawUI=function(t,e,i){for(let e=0;e<WIDTH;e++)t.draw(e,HEIGHT-UI_HEIGHT,MAP_FILLED_SPACE,"blue","blue");t.drawText(1,HEIGHT-UI_HEIGHT,"%c{white}%b{blue}HP: "+i.fighter.hp+"/"+i.fighter.maxHp),t.drawText(14,HEIGHT-UI_HEIGHT,"%c{white}%b{blue}Mana: "+i.fighter.mana+"/"+i.fighter.maxMana),t.drawText(30,HEIGHT-UI_HEIGHT,"%c{white}%b{blue}STR: "+i.fighter.strength),t.drawText(38,HEIGHT-UI_HEIGHT,"%c{white}%b{blue}DEF: "+i.fighter.defense),t.drawText(46,HEIGHT-UI_HEIGHT,"%c{white}%b{blue}LVL: "+i.fighter.level),t.drawText(54,HEIGHT-UI_HEIGHT,"%c{white}%b{blue}EXP: "+i.fighter.experience+"/"+(LEVEL_UP_BASE+i.fighter.level*LEVEL_UP_FACTOR))},showSelectionMenu=function(t,e,i,n){if(e.length>26)return void console.error("too many items");const o="a".charCodeAt(0),r=e.length+UI_HEIGHT;for(let t=0;t<n;t++)for(let e=0;e<r;e++)0===t||0===e||t===n-1||e===r-1?Game.display.draw(t,e,"1","grey","grey"):Game.display.draw(t,e,"1","black","black");Game.display.drawText(2,1,"%c{white}%b{black}"+t);for(let t=0;t<e.length;t++)switch(i){case"inventory":Game.display.drawText(2,t+3,`%c{white}%b{black} ${String.fromCharCode(t+o)}: ${e[t].name} (${e[t].count})`);break;case"spells":Game.display.drawText(2,t+3,`%c{white}%b{black} ${String.fromCharCode(t+o)}: ${e[t].name} dmg: ${e[t].value} cost: ${e[t].manaCost}`);break;default:throw new Error(`Unknown menu type ${i}`)}},showKeyBindingMenu=function(){const t=WIDTH;for(let e=0;e<t;e++)for(let i=0;i<16;i++)0===e||0===i||e===t-1||15===i?Game.display.draw(e,i,"1","grey","grey"):Game.display.draw(e,i,"1","black","black");Game.display.drawText(2,1,"%c{white}%b{black} Keyboard Bindings"),Game.display.drawText(2,3,"%c{white}%b{black} Click on an option to change it");let e=Object.keys(keyCommandMap);for(let t=0;t<e.length;t++){let i=e[t];Game.display.drawText(2,t+5,"%c{white}%b{black} "+keyCommandMap[i][0]+": "+i)}},clearScreen=function(t){for(let e=0;e<HEIGHT;e++)for(let i=0;i<WIDTH;i++)t.draw(i,e,MAP_EMPTY_SPACE,"black","black")},WIDTH=70,HEIGHT=45,UI_HEIGHT=6,WORLD_WIDTH=WIDTH,WORLD_HEIGHT=HEIGHT-UI_HEIGHT-1,COLOR_INVISIBLE_WALL="black",COLOR_DARK_WALL="rgb(20, 20, 20)",COLOR_LIGHT_WALL="#352620",COLOR_INVISIBLE_GROUND="black",COLOR_DARK_GROUND="rgb(50, 50, 50)",COLOR_LIGHT_GROUND="white",COLOR_AMBIENT_LIGHT="rgb(50, 50, 50)",MAP_FILLED_SPACE="#",MAP_EMPTY_SPACE=".",LEVEL_UP_BASE=50,LEVEL_UP_FACTOR=150,DamageType={physical:1,fire:2,lightning:3,ice:4,nature:5};Object.freeze(DamageType);const Affinity={weak:.5,normal:1,strong:2,nullified:0};Object.freeze(Affinity);const tileData={900:{name:"empty ground",char:"",fgColor:"white",bgColor:"white",fgColorExplored:COLOR_DARK_GROUND,bgColorExplored:COLOR_DARK_GROUND,blocks:!1,blocksSight:!1,reflectivity:.18},1048:{name:"A wall",char:"",fgColor:"#352620",bgColor:"#352620",fgColorExplored:COLOR_DARK_WALL,bgColorExplored:COLOR_DARK_WALL,blocks:!0,blocksSight:!0,reflectivity:.18},1165:{name:"A tree",char:"",fgColor:"lightgreen",bgColor:"darkgreen",fgColorExplored:COLOR_DARK_WALL,bgColorExplored:COLOR_DARK_WALL,blocks:!0,blocksSight:!0,reflectivity:.18},2710:{name:"A table",char:"",fgColor:"tan",bgColor:"brown",fgColorExplored:COLOR_DARK_WALL,bgColorExplored:COLOR_DARK_WALL,blocks:!0,blocksSight:!1,reflectivity:.18},2869:{name:"A chair",char:"",fgColor:"black",bgColor:"brown",fgColorExplored:COLOR_DARK_WALL,bgColorExplored:COLOR_DARK_WALL,blocks:!0,blocksSight:!1,reflectivity:.18},2936:{name:"A cabinet",char:"",fgColor:"black",bgColor:"brown",fgColorExplored:COLOR_DARK_WALL,bgColorExplored:COLOR_DARK_WALL,blocks:!0,blocksSight:!1,reflectivity:.18}};Object.freeze(tileData);const objectData={door:{name:"Door",graphics:"basic_graphics",ai:null,inventory:null,fighter:null,interactable:"door_interactable",char:"",fgColor:"white",bgColor:"brown",blocks:!0,blocksSight:!0},load_door:{name:"Door to new area",graphics:"draw_after_seen",ai:null,inventory:null,fighter:null,interactable:"load_level_interactable",char:"",fgColor:"white",bgColor:"black",blocks:!0,blocksSight:!0},stairs:{name:"Stairs",graphics:"draw_after_seen",ai:null,inventory:null,fighter:null,interactable:"load_level_interactable",char:"",fgColor:"white",bgColor:"black",blocks:!0,blocksSight:!1},chest:{name:"Chest",graphics:"draw_after_seen",ai:"chest_ai",fighter:null,inventory:"basic_inventory",interactable:"give_items_interactable",char:"*",fgColor:"white",bgColor:"brown",emptyColor:"purple",blocks:!0,blocksSight:!1},crate:{name:"Wooden Crate",graphics:"basic_graphics",ai:null,fighter:"basic_fighter",inventory:"basic_inventory",interactable:null,char:"",fgColor:"white",bgColor:"brown",emptyColor:"purple",blocks:!0,blocksSight:!1,experience:0,experienceGiven:0,maxHp:5,strength:0,defense:0,onDeath:"removeFromWorld"},lantern:{name:"Small Lantern",graphics:"basic_graphics",lighting:"reflectivity",lightingColor:"yellow",lightingRange:4,ai:null,fighter:null,inventory:null,interactable:null,char:"",fgColor:"black",bgColor:"yellow",blocks:!0,blocksSight:!1},campfire:{name:"Small Fire",graphics:"basic_graphics",lighting:"reflectivity",lightingColor:"orange",lightingRange:6,ai:null,fighter:null,inventory:null,interactable:null,char:"",fgColor:"black",bgColor:"orange",blocks:!0,blocksSight:!1},dropped_item:{name:"Dropped Item",graphics:"basic_graphics",ai:"dropped_item_ai",inventory:null,fighter:null,interactable:"give_items_interactable",char:"!",fgColor:"white",bgColor:"brown",blocks:!1,blocksSight:!1},magic_shrine:{name:"Magicka Shrine",graphics:"basic_graphics",ai:null,fighter:null,interactable:"give_spell_interactable",char:"",fgColor:"black",bgColor:"gold",blocks:!0,blocksSight:!1},player:{name:"The Player",graphics:"basic_graphics",lighting:"player_lighting",lightingColor:"white",lightingRange:7,ai:"player_control_ai",inventory:"basic_inventory",fighter:"basic_fighter",interactable:null,char:"@",fgColor:"blue",blocks:!0,blocksSight:!1,bgColor:"transparent",level:1,experience:0,experienceGiven:0,maxHp:100,maxMana:100,strength:3,defense:1,damageAffinity:{[DamageType.physical]:Affinity.normal,[DamageType.fire]:Affinity.normal,[DamageType.lightning]:Affinity.normal,[DamageType.ice]:Affinity.normal,[DamageType.nature]:Affinity.normal},onDeath:"default"},goblin:{name:"Goblin",graphics:"basic_graphics",ai:"basic_monster_ai",fighter:"basic_fighter",inventory:"basic_inventory",interactable:null,char:"G",fgColor:"green",bgColor:"transparent",blocks:!0,blocksSight:!1,level:3,experience:0,experienceGiven:50,maxHp:30,maxMana:0,strength:3,defense:1,sightRange:7,damageAffinity:{[DamageType.physical]:Affinity.normal,[DamageType.fire]:Affinity.normal,[DamageType.lightning]:Affinity.normal,[DamageType.ice]:Affinity.normal,[DamageType.nature]:Affinity.normal},inventoryPool:[["health_potion_weak",.25]],onDeath:"default"},goblin_brute:{name:"Goblin Brute",graphics:"basic_graphics",ai:"patrolling_monster_ai",fighter:"basic_fighter",inventory:"basic_inventory",interactable:null,char:"G",fgColor:"green",bgColor:"red",blocks:!0,blocksSight:!1,level:10,experience:0,experienceGiven:500,maxHp:100,maxMana:0,strength:7,defense:4,sightRange:7,damageAffinity:{[DamageType.physical]:Affinity.normal,[DamageType.fire]:Affinity.normal,[DamageType.lightning]:Affinity.normal,[DamageType.ice]:Affinity.normal,[DamageType.nature]:Affinity.normal},inventoryPool:[["health_potion_weak",.25],["health_potion",.1]],onDeath:"default"},rat:{name:"Rat",graphics:"basic_graphics",ai:"basic_monster_ai",fighter:"basic_fighter",inventory:"basic_inventory",interactable:null,char:"r",fgColor:"brown",bgColor:"transparent",blocks:!0,blocksSight:!1,level:1,experience:0,experienceGiven:10,maxHp:10,maxMana:0,strength:2,defense:1,sightRange:7,damageAffinity:{[DamageType.physical]:Affinity.normal,[DamageType.fire]:Affinity.normal,[DamageType.lightning]:Affinity.normal,[DamageType.ice]:Affinity.normal,[DamageType.nature]:Affinity.normal},inventoryPool:[],onDeath:"default"}};Object.freeze(objectData);const itemData={health_potion_weak:{displayName:"Weak Health Potion",value:25,type:"health",useFunc:castHeal},health_potion:{displayName:"Health Potion",value:50,type:"health",useFunc:castHeal},health_potion_strong:{displayName:"Health Potion",value:100,type:"health",useFunc:castHeal},lightning_scroll_weak:{displayName:"Weak Scroll of Lightning",value:20,type:"damage_scroll",useFunc:castDamageSpell,damageType:DamageType.lightning},lightning_scroll:{displayName:"Scroll of Lightning",value:50,type:"damage_scroll",useFunc:castDamageSpell,damageType:DamageType.lightning},lightning_scroll_strong:{displayName:"Strong Scroll of Lightning",value:100,type:"damage_scroll",useFunc:castDamageSpell,damageType:DamageType.lightning},fireball_scroll_weak:{displayName:"Weak Scroll of Fire",value:20,type:"damage_scroll",useFunc:castDamageSpell,damageType:DamageType.fire,statusEffectFunc:createBurnEffect},fireball_scroll:{displayName:"Scroll of Fire",value:50,type:"damage_scroll",useFunc:castDamageSpell,damageType:DamageType.fire,statusEffectFunc:createBurnEffect},fireball_scroll_strong:{displayName:"Strong Scroll of Fire",value:100,type:"damage_scroll",useFunc:castDamageSpell,damageType:DamageType.fire,statusEffectFunc:createBurnEffect},lightning_scroll_weak_wild:{displayName:"Weak Scroll of Wild Lightning",value:50,type:"wild_damage_scroll",useFunc:castWildDamageSpell,damageType:DamageType.lightning},lightning_scroll_wild:{displayName:"Scroll of Wild Lightning",value:100,type:"wild_damage_scroll",useFunc:castWildDamageSpell,damageType:DamageType.lightning},lightning_scroll_strong_wild:{displayName:"Strong Scroll of Wild Lightning",value:150,type:"wild_damage_scroll",useFunc:castWildDamageSpell,damageType:DamageType.lightning},fireball_scroll_weak_wild:{displayName:"Weak Scroll of Wild Fire",value:50,type:"wild_damage_scroll",useFunc:castWildDamageSpell,damageType:DamageType.fire,statusEffectFunc:createBurnEffect},fireball_scroll_wild:{displayName:"Scroll of Wild Fire",value:100,type:"wild_damage_scroll",useFunc:castWildDamageSpell,damageType:DamageType.fire,statusEffectFunc:createBurnEffect},fireball_scroll_strong_wild:{displayName:"Strong Scroll of Wild Fire",value:150,type:"wild_damage_scroll",useFunc:castWildDamageSpell,damageType:DamageType.fire,statusEffectFunc:createBurnEffect},confuse_scroll:{displayName:"Scroll of Confuse Enemy",value:8,type:"confuse_scroll",useFunc:castConfuse},clairvoyance_scroll:{displayName:"Scroll of Clairvoyance",type:"clairvoyance_scroll",useFunc:castClairvoyance}};Object.freeze(itemData);const spellData={lightning_bolt:{name:"Lightning Bolt",manaCost:50,value:10,useFunc:castDamageSpell}},randomIntFromInterval=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},mouseLook=function(t){const e=Game.display.eventToPosition(t),i=getObjectsAtLocation(Game.gameObjects,e[0],e[1])[0];i&&i.name&&i.ai&&i.ai.state?"wander"===i.ai.state?Game.displayMessage("A "+i.name+", it hasn't seen you."):Game.displayMessage("A "+i.name):i&&i.name?Game.displayMessage(i.name):i||Game.displayMessage(Game.map[e[1]][e[0]].name)};class Manager{act(){Game.engine.lock(),Game.currentTurn++,null!==Game.player.fighter?(resetVisibility(Game.map),Game.drawAll(),Game.engine.unlock()):Game.loseCinematic()}}let Game={canvas:null,display:null,player:null,engine:null,scheduler:null,gameObjects:[],map:[],currentLogLines:[],currentLevel:0,currentTurn:0,totalMessages:0,init:function(){this.display=new ROT.Display({width:WIDTH,height:HEIGHT,fontSize:13,forceSquareRatio:!0}),this.canvas=this.display.getContainer(),document.getElementById("canvas").appendChild(this.canvas),this.openingCinematic()},reset:function(){clearScreen(this.display),this.player.fighter=null,this.player.ai=null,window.removeEventListener("keydown",this.player.ai),this.player=null,this.currentLevel=0,this.map=[],this.gameObjects=[],this.currentLogLines=[],this.scheduler.clear()},openingCinematic:function(){this.display.drawText(WIDTH-(WIDTH-7),12,"%c{white}Your country is being overrun by the forces of darkness"),this.display.drawText(WIDTH-(WIDTH-8),15,"%c{white}Tales tell of a weapon of great power lost in the"),this.display.drawText(WIDTH-(WIDTH-4),16,"%c{white}lands beyond the dwarf stronghold Durdwin, under the Red Hills."),this.display.drawText(WIDTH-(WIDTH-17),18,"%c{white}None who have entered have returned"),this.display.drawText(WIDTH-(WIDTH-14),20,"%c{white}It is the last hope of a desperate people"),this.display.drawText(WIDTH-(WIDTH-16),21,"%c{white}You have volunteered to retrieve it"),this.display.drawText(WIDTH-(WIDTH-24),27,"%c{white}Press [enter] to start");const t=this;window.addEventListener("keydown",function e(i){"Enter"===i.key&&(t.startGameplay(),window.removeEventListener("keydown",e))})},winCinematic:function(){this.reset(),this.display.drawText(WIDTH-(WIDTH-12),12,"%c{white}You have reached the bottom and have retrieved"),this.display.drawText(WIDTH-(WIDTH-16),13,"%c{white}the fabled weapon and saved your people"),this.display.drawText(WIDTH-(WIDTH-18),24,"%c{white}Press [enter] to restart the game");const t=this;window.addEventListener("keydown",function e(i){"Enter"===i.key&&(t.startGameplay(),window.removeEventListener("keydown",e))})},loseCinematic:function(){this.reset(),this.display.drawText(WIDTH-(WIDTH-5),12,"%c{white}You have died, and the last hope of your people dies with you"),this.display.drawText(WIDTH-(WIDTH-18),24,"%c{white}Press [enter] to restart the game");const t=this;window.addEventListener("keydown",function e(i){"Enter"===i.key&&(t.startGameplay(),window.removeEventListener("keydown",e))})},startGameplay:function(){this.hookMouseLook(),this.scheduler=new ROT.Scheduler.Simple,this.manager=new Manager,this.player=createObject("player",1,1),this.loadLevel("level_1")},displayMessage:function(t){this.totalMessages++;for(let t=0;t<WIDTH;t++)for(let e=1;e<UI_HEIGHT;e++)this.display.draw(t,HEIGHT-e,MAP_FILLED_SPACE,"black","black");5===this.currentLogLines.length&&this.currentLogLines.splice(0,1),this.currentLogLines.push(this.totalMessages+") "+t);for(let t=0;t<this.currentLogLines.length;t++)this.display.drawText(0,HEIGHT-5+t,"%c{white}"+this.currentLogLines[t])},drawAll(){this.gameObjects.filter(t=>t.lighting&&"function"==typeof t.lighting.compute).forEach(t=>t.lighting.compute(Game.map)),this.player.lighting.compute(this.map),drawMap(this.display,this.map),this.gameObjects.filter(t=>t.graphics&&"function"==typeof t.graphics.draw).forEach(t=>t.graphics.draw(Game.display,Game.map)),this.player.graphics.draw(this.display,this.map),drawUI(this.display,this.currentLevel,this.player)},loadLevel:function(t){if(this.currentLevel++,21===this.currentLevel)return void this.winCinematic();const{map:e,playerLocation:i,objects:n}=loadTiledMap(t);this.map=e,this.gameObjects=n,this.player.x=i[0],this.player.y=i[1],this.player.fighter.mana=this.player.fighter.maxMana,this.scheduler.clear(),this.scheduler.add(this.manager,!0),this.scheduler.add(this.player,!0),this.gameObjects.forEach(t=>this.scheduler.add(t,!0)),this.engine=new ROT.Engine(this.scheduler),this.engine.start()},hookMouseLook:function(){this.canvas.addEventListener("mousedown",mouseLook)},unhookMouseLook:function(){this.canvas.removeEventListener("mousedown",mouseLook)},addObject:function(t){this.gameObjects.push(t),this.scheduler.add(this.gameObjects[this.gameObjects.length-1],!0)},removeObject:function(t){this.gameObjects.splice(this.gameObjects.indexOf(t),1),this.scheduler.remove(t)}};window.onload=function(){Game.init()};
//# sourceMappingURL=game.min.js.map
